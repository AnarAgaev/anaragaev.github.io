import{u as M,j as e,b as V,r as j}from"./index.js";import{g as ce}from"./getFileName.js";import{a as le,f as N,b as re,g as ae}from"./getTotalPriceConfiguration.js";const de=s=>{const o=new Map;for(const t of s)if(o.has(t.article)){const i=o.get(t.article);i.count=i.count+t.count}else o.set(t.article,{...t});return Array.from(o.values())},ue="_help_d03wd_2",_e="_composition_d03wd_29",he="_room_d03wd_35",me="_title_d03wd_41",pe="_subtitle_d03wd_51",be="_sets_d03wd_72",xe="_set_d03wd_72",je="_table_d03wd_104",ve="_dropped_d03wd_111",fe="_desc_d03wd_114",we="_item_d03wd_215",$e="_pic_d03wd_225",ke="_counter_d03wd_315",Ce="_withoutBorder_d03wd_380",Ne="_disabled_d03wd_384",ge="_inc_d03wd_389",Pe="_dec_d03wd_393",ye="_prices_d03wd_397",Ee={help:ue,composition:_e,room:he,title:me,subtitle:pe,sets:be,set:xe,table:je,dropped:ve,desc:fe,item:we,pic:$e,counter:ke,withoutBorder:Ce,disabled:Ne,inc:ge,dec:Pe,prices:ye},F=window.userToken,{help:Le,composition:R,room:Se,title:H,subtitle:Te,sets:Ae,set:De,table:Be,item:z,pic:G,desc:J,counter:Fe,disabled:q,inc:W,dec:O,dropped:Re,withoutBorder:qe,prices:K}=Ee,We=s=>{const o=typeof s.price=="string"?parseFloat(s.price):s.price,t=s.start_price??typeof s.start_price=="string"?parseFloat(s.start_price):s.start_price;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:z,children:[e.jsx("span",{className:G,children:e.jsx("img",{src:s.preview,alt:s.name})}),e.jsxs("span",{className:J,children:[e.jsx("mark",{children:s.name}),e.jsx("i",{children:s.show_article})]})]})}),e.jsx("td",{children:s.active&&s.available?1:e.jsx(U,{})}),e.jsx("td",{children:e.jsxs("div",{className:K,children:[e.jsxs("span",{children:[N(o)," р."]}),t&&t!==o&&e.jsx(Q,{price:N(t)})]})})]},s.show_article)},Oe=s=>V(s).map(t=>{const i=typeof t.price=="string"?parseFloat(t.price):t.price,c=t.start_price??typeof t.start_price=="string"?parseFloat(t.start_price):t.start_price;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:z,children:[e.jsx("span",{className:G,children:e.jsx("img",{src:t.preview,alt:t.name})}),e.jsxs("span",{className:J,children:[e.jsx("mark",{children:t.name}),e.jsx("i",{children:t.show_article})]})]})}),e.jsx("td",{children:t.active&&t.available?t.selectedCount:e.jsx(U,{})}),e.jsx("td",{children:e.jsxs("div",{className:K,children:[e.jsxs("span",{children:[N(i*t.selectedCount)," р."]}),c&&c!==i&&e.jsx(Q,{price:N(c*t.selectedCount)})]})})]},t.show_article)}),Me=(s,o,t,i,c,l,u,_,p,d,v,b,m,a,x,f)=>{const h=[];return s.forEach((n,P)=>{var T,A;const X=n.border?n.border.vendor:n.devices&&n.devices[0]!==null?n.devices[0].vendor:"",y=n.border&&n.border.number_of_posts?parseInt(n.border.number_of_posts[0]):1,Y=`, ${y} ${y?re(y):""}`,E=new Set;n.border&&E.add(n.border.color),n.devices&&n.devices.forEach(r=>r&&E.add(r.color));const Z=Array.from(E).join("/"),S=r=>i(o,t,n.id,{direction:r}),I=r=>{let $=Math.abs(parseInt(r.target.value.replace(/\D/g,"")));$||($=0),i(o,t,n.id,{value:$})},ee=r=>{r.target.value===""&&i(o,t,n.id,{value:1})},se=()=>c(o,t,n.id),te=()=>{u({projectId:o,roomId:t,configurationId:n.id,type:"replace"}),l("replace",!0,"Перенести комплект")},ne=()=>{u({projectId:o,roomId:t,configurationId:n.id,type:"copy"}),l("copy",!0,"Копировать комплект")},oe=()=>{_(o,t,n.id);let r=null,$=null,D=null,k=null;if(n.border){r=n.border,D=p(n.border);const C=n.border.number_of_posts;$=C?parseInt(C[0]):1}if(n.devices&&(k=n.devices),b(r,$,D,k,n.direction),r||k){const C=r?r.collection:k[0].collection,B=r?r.vendor:k[0].vendor;d("collection",C),d("brand",B),v("collection",C),v("brand",B)}m(n.background)},w=a||F!==void 0&&F===x,ie=n.devices&&n.devices.some(r=>(r==null?void 0:r.active)&&r.available),L=((T=n.border)==null?void 0:T.active)&&((A=n.border)==null?void 0:A.available)||ie;h.push(e.jsxs("li",{className:De,children:[e.jsx("p",{className:Te,children:`Комплект ${X}, ${Z}${Y}`}),e.jsxs("table",{className:`${Be} ${Re}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Состав комплектующих"}),e.jsx("th",{children:"Количество"}),e.jsx("th",{children:"Стоимость"})]})}),e.jsxs("tbody",{children:[n.border&&We(n.border),n.devices&&Oe(n.devices)]}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{id:f===0&&P===0?"step_22":void 0,children:[w&&e.jsxs("button",{onClick:oe,className:`button button_small button_dark ${L?"":"disabled"}`,title:"Изменить комплект",children:[e.jsx("span",{children:"Изменить"}),e.jsx("i",{className:"icon icon_change"})]}),w&&e.jsxs("button",{onClick:te,className:`button button_small button_dark ${L?"":"disabled"}`,title:"Перенести комплект в другой проект/помещение",children:[e.jsx("span",{children:"Перенести"}),e.jsx("i",{className:"icon icon_move"})]}),e.jsxs("button",{onClick:ne,className:`button button_small button_dark ${w?"":"single"} ${L?"":"disabled"}`,title:"Скопировать комплект в другой проект/помещение",children:[e.jsx("span",{children:"Скопировать"}),e.jsx("i",{className:"icon icon_copy"})]}),w&&e.jsxs("button",{onClick:se,title:"Удалить комплект",className:"button button_small button_dark",children:[e.jsx("span",{children:"Удалить"}),e.jsx("i",{className:"icon icon_basket"})]})]})}),e.jsx("td",{children:e.jsxs("div",{id:f===0&&P===0?"step_23":void 0,className:Fe,children:[w&&e.jsx("button",{className:n.count===1||n.count===0?`${O} ${q}`:O,onClick:()=>S(-1)}),e.jsx("input",{type:"text",className:w?"":qe,value:n.count===0?"":n.count,onChange:I,onBlur:ee}),w&&e.jsx("button",{className:n.count===0?`${W} ${q}`:W,onClick:()=>S(1)})]})}),e.jsxs("td",{children:[le(n)," р."]})]})})]})]},`${n.id}-${P}`))}),h},Ve=(s,o,t,i,c,l,u,_,p,d,v)=>{const b=[],m=s.rooms;return!m||m&&m.length===0?null:(m.forEach((a,x)=>{const f=Me(a.configurations,s.id,a.id,o,t,i,c,l,u,_,p,d,v,s.localProject,s.token,x);b.push(e.jsxs("div",{className:Se,children:[e.jsx("h3",{className:H,children:e.jsx("span",{id:x===0?"step_18":void 0,children:a.name})}),e.jsx("ul",{id:x===0&&x===0?"step_21":void 0,className:Ae,children:f})]},`${a.id}-${x}`))}),b)},He=({project:s})=>{var m;const[o,t,i,c,l,u,_,p,d,v]=M(a=>[a.setConfigurationCount,a.removeConfiguration,a.modalCopyConfigurationSet,a.setCurrentConfiguration,a.setEditConfiguration,a.getCountOfPosts,a.setSingleBordersFilter,a.setSingleDevicesFilter,a.setEditSketch,a.setEditBackground]),b=Ve(s,o,t,i,c,l,u,_,p,d,v);return s&&!((m=s.rooms)!=null&&m.length)?e.jsxs("div",{className:R,children:[e.jsx("h3",{className:H,children:"В проект не добавлено ни одного комплекта!"}),e.jsxs("ul",{className:Le,children:[e.jsx("li",{children:"Перейдите на вкладку Конфигуратор;"}),e.jsx("li",{children:"Добавьте Рамку и Устройство на холст;"}),e.jsx("li",{children:"Выберите Проект и Помещение;"}),e.jsx("li",{children:"Кликните Добавить в проект, чтобы добавить комплект."})]})]}):e.jsx("div",{className:R,children:b})},ze="_text_bk6nq_1",Ge="_tooltip_bk6nq_15",Je="_show_bk6nq_68",Ke={text:ze,tooltip:Ge,show:Je},{text:Qe,tooltip:Ue,show:Xe}=Ke,Q=({price:s})=>{const o=j.useRef(null),[t,i]=j.useState(!1),c=()=>{window.innerWidth<=1200&&i(!t)},l=j.useCallback(_=>{if(!o.current)return;const p=_.target;o.current.contains(p)||i(!1)},[]),u=j.useCallback(()=>i(!1),[]);return j.useEffect(()=>(window.addEventListener("scrollend",u),document.addEventListener("click",l),()=>{window.removeEventListener("scrollend",u),document.removeEventListener("click",l)}),[u,l]),e.jsxs("span",{ref:o,className:Qe,onClick:c,children:[s," р.",e.jsx("mark",{className:`${Ue} ${t?Xe:""}`,children:"Цена товара изменилась"})]})},Ye="_text_c3fsw_1",Ze="_tooltip_c3fsw_25",Ie="_show_c3fsw_64",es={text:Ye,tooltip:Ze,show:Ie},{text:ss,tooltip:ts,show:ns}=es,U=()=>{const s=j.useRef(null),[o,t]=j.useState(!1),i=()=>{window.innerWidth<=1200&&t(!o)},c=j.useCallback(u=>{if(!s.current)return;const _=u.target;s.current.contains(_)||t(!1)},[]),l=j.useCallback(()=>t(!1),[]);return j.useEffect(()=>(window.addEventListener("scrollend",l),document.addEventListener("click",c),()=>{window.removeEventListener("scrollend",l),document.removeEventListener("click",c)}),[l,c]),e.jsxs("span",{ref:s,className:ss,onClick:i,children:["нет в наличии",e.jsx("mark",{className:`${ts} ${o?ns:""}`,children:"Будет удален при редактировании, переносе и копировании комплекта"})]})},os="_wrap_44wbd_14",is="_wrapCenter_44wbd_22",cs="_caption_44wbd_31",ls="_title_44wbd_37",rs="_subtitle_44wbd_45",as="_body_44wbd_102",ds="_footer_44wbd_108",us="_actions_44wbd_123",_s="_total_44wbd_141",hs="_shine_44wbd_1",ms={wrap:os,wrapCenter:is,caption:cs,title:ls,subtitle:rs,body:as,footer:ds,actions:us,total:_s,"image-failed":"_image-failed_44wbd_1",shine:hs},{wrap:ps,wrapCenter:bs,caption:xs,title:js,subtitle:vs,body:fs,footer:ws,actions:$s,total:ks}=ms,g=window.userToken,Cs=(s,o,t,i,c,l,u)=>s?e.jsxs("ul",{id:"step_19",className:$s,children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>o(s.id),className:"button button_dark",title:"Поделиться проектом",children:e.jsx("i",{className:"icon icon_share"})})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>c({project:s,filename:ce(s.name,s.id)}),className:"button button_dark",title:"Скачать проект как PDF файл",children:e.jsx("i",{className:"icon icon_down"})})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>i(!0,""),className:"button button_dark",title:"Загрузить проект по ссылке",children:e.jsx("i",{className:"icon icon_upload"})})}),(s.token===null||s.token!==g)&&e.jsx("li",{children:e.jsx("button",{onClick:()=>l(s.id,g),className:"button button_dark",title:`Скопировать проект себе${g?"":" локально"}`,children:e.jsx("i",{className:"icon icon_copy"})})}),(s.localProject||s.token&&s.token===g)&&e.jsx("li",{children:e.jsx("button",{onClick:()=>s.localProject?u(s.id,s.name):t(s.id,s.name),className:"button button_dark",title:s.localProject?"Удалить локальный проект":"Удалить проект",children:e.jsx("i",{className:"icon icon_basket"})})})]}):null,Ns=s=>{const o=[];return s.rooms?(s.rooms.forEach(t=>{t.configurations.forEach(i=>{const c=i.border,l=i.devices;c&&o.push({type:"border",article:c.article,count:i.count}),l&&l.length&&V(l).forEach(_=>{o.push({type:"device",article:_.article,count:_.selectedCount*i.count})})})}),de(o)):o},Es=()=>{var x,f;const[s,o,t,i,c,l,u,_,p]=M(h=>[h.projects,h.setActiveViewportTab,h.removeProject,h.shareProject,h.modalLoadProjectSet,h.setDownloadProject,h.addProductsToCart,h.copyProject,h.removeLocalProject]),d=s.filter(h=>h.edit)[0],v=Cs(d,i,t,c,l,_,p),b=ae(d);let m="button button_dark button_block";d&&!((x=d.rooms)!=null&&x.length)&&(m+=" disabled");const a=()=>{u(Ns(d))};return d?e.jsxs("div",{className:ps,children:[e.jsx("h2",{className:xs,children:e.jsx("span",{id:"step_17",children:d.name})}),e.jsx("div",{className:fs,children:e.jsx(He,{project:d})}),e.jsxs("footer",{className:ws,children:[v,e.jsxs("div",{id:"step_20",className:ks,children:[d&&((f=d.rooms)==null?void 0:f.length)&&b!==0&&e.jsxs("p",{children:[e.jsx("span",{children:"Общая стоимость:"}),e.jsxs("strong",{children:[N(b)," р."]})]}),e.jsx("button",{onClick:a,className:`${m}${b===0?" disabled":""}`,children:"Добавить в корзину"})]})]})]}):e.jsxs("div",{className:bs,children:[e.jsx("h2",{className:js,children:"Вначале необходимо выбрать проект"}),e.jsxs("p",{className:vs,children:["Перейдите на вкладку ",e.jsx("button",{onClick:()=>o("hub"),children:"Мои проекты"})," и кликните по иконке ",e.jsxs("span",{children:[e.jsx("i",{})," (Редактировать)"]})," одного из проектов."]})]})};export{Es as default};
