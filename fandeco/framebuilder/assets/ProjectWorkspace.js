import{u as M,j as e,E as V,r as p}from"./index.js";import{g as le}from"./getFileName.js";import{a as re,f as y,b as ae,g as de}from"./getTotalPriceConfiguration.js";import{c as z}from"./collapseDevices.js";const ue=t=>{const n=new Map;for(const o of t)if(n.has(o.article)){const i=n.get(o.article);i.count=i.count+o.count}else n.set(o.article,{...o});return Array.from(n.values())},me=t=>{const{rooms:n,roomId:o}=t,i=n.find(l=>l.id===o);return(i==null?void 0:i.default)??!1},_e="_help_1t3jg_2",he="_composition_1t3jg_29",je="_room_1t3jg_35",pe="_title_1t3jg_41",xe="_subtitle_1t3jg_54",be="_sets_1t3jg_75",ve="_set_1t3jg_75",fe="_table_1t3jg_107",ge="_dropped_1t3jg_114",$e="_desc_1t3jg_117",ke="_item_1t3jg_218",Ce="_pic_1t3jg_228",Ne="_counter_1t3jg_318",we="_withoutBorder_1t3jg_383",ye="_disabled_1t3jg_387",Pe="_inc_1t3jg_392",Ee="_dec_1t3jg_396",Se="_prices_1t3jg_400",Le={help:_e,composition:he,room:je,title:pe,subtitle:xe,sets:be,set:ve,table:fe,dropped:ge,desc:$e,item:ke,pic:Ce,counter:Ne,withoutBorder:we,disabled:ye,inc:Pe,dec:Ee,prices:Se},D=window.userToken,{help:Re,composition:F,room:Te,title:H,subtitle:Ae,sets:Be,set:De,table:Fe,item:G,pic:I,desc:J,counter:qe,disabled:q,inc:W,dec:O,dropped:We,withoutBorder:Oe,prices:K}=Le,Me=t=>{const n=typeof t.price=="string"?parseFloat(t.price):t.price,o=t.start_price??typeof t.start_price=="string"?parseFloat(t.start_price):t.start_price;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:G,children:[e.jsx("span",{className:I,children:e.jsx("img",{src:t.preview,alt:t.name})}),e.jsxs("span",{className:J,children:[e.jsx("mark",{children:t.name}),e.jsx("i",{children:t.show_article})]})]})}),e.jsx("td",{children:t.active&&t.available?1:e.jsx(U,{})}),e.jsx("td",{children:e.jsxs("div",{className:K,children:[e.jsxs("span",{children:[y(n)," р."]}),o&&o!==n&&e.jsx(Q,{price:y(o)})]})})]},t.show_article)},Ve=t=>z(t).map(o=>{const i=typeof o.price=="string"?parseFloat(o.price):o.price,l=o.start_price??typeof o.start_price=="string"?parseFloat(o.start_price):o.start_price;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:G,children:[e.jsx("span",{className:I,children:e.jsx("img",{src:o.preview,alt:o.name})}),e.jsxs("span",{className:J,children:[e.jsx("mark",{children:o.name}),e.jsx("i",{children:o.show_article})]})]})}),e.jsx("td",{children:o.active&&o.available?o.selectedCount:e.jsx(U,{})}),e.jsx("td",{children:e.jsxs("div",{className:K,children:[e.jsxs("span",{children:[y(i*o.selectedCount)," р."]}),l&&l!==i&&e.jsx(Q,{price:y(l*o.selectedCount)})]})})]},o.show_article)}),ze=(t,n,o,i,l,r,u,m,j,x,d,f,b,v,_,c)=>{const h=[];return t.forEach((s,k)=>{var R,T;const X=s.border?s.border.vendor:s.devices&&s.devices[0]!==null?s.devices[0].vendor:"",P=s.border&&s.border.number_of_posts?parseInt(s.border.number_of_posts[0]):1,Y=`, ${P} ${P?ae(P):""}`,E=new Set;s.border&&E.add(s.border.color),s.devices&&s.devices.forEach(a=>a&&E.add(a.color));const Z=Array.from(E).join("/"),L=a=>i(n,o,s.id,{direction:a}),ee=a=>{let $=Math.abs(parseInt(a.target.value.replace(/\D/g,"")));$||($=0),i(n,o,s.id,{value:$})},te=a=>{a.target.value===""&&i(n,o,s.id,{value:1})},se=()=>l(n,o,s.id),oe=()=>{u({projectId:n,roomId:o,configurationId:s.id,type:"replace"}),r("replace",!0,"Перенести комплект")},ne=()=>{u({projectId:n,roomId:o,configurationId:s.id,type:"copy"}),r("copy",!0,"Копировать комплект")},ie=()=>{m(n,o,s.id);let a=null,$=null,A=null,C=null;if(s.border){a=s.border,A=j(s.border);const N=s.border.number_of_posts;$=N?parseInt(N[0]):1}if(s.devices&&(C=s.devices),f(a,$,A,C,s.direction),a||C){const N=a?a.collection:C[0].collection,B=a?a.vendor:C[0].vendor;x("collection",N),x("brand",B),d("collection",N),d("brand",B)}b(s.background)},g=v||D!==void 0&&D===_,ce=s.devices&&s.devices.some(a=>(a==null?void 0:a.active)&&a.available),S=((R=s.border)==null?void 0:R.active)&&((T=s.border)==null?void 0:T.available)||ce;h.push(e.jsxs("li",{className:De,children:[e.jsx("p",{className:Ae,children:`Комплект ${X}, ${Z}${Y}`}),e.jsxs("table",{className:`${Fe} ${We}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Состав комплектующих"}),e.jsx("th",{children:"Количество"}),e.jsx("th",{children:"Стоимость"})]})}),e.jsxs("tbody",{children:[s.border&&Me(s.border),s.devices&&Ve(s.devices)]}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{id:c===0&&k===0?"step_22":void 0,children:[g&&e.jsxs("button",{onClick:ie,className:`button button_small button_dark ${S?"":"disabled"}`,title:"Изменить комплект",children:[e.jsx("span",{children:"Изменить"}),e.jsx("i",{className:"icon icon_change"})]}),g&&e.jsxs("button",{onClick:oe,className:`button button_small button_dark ${S?"":"disabled"}`,title:"Перенести комплект в другой проект/помещение",children:[e.jsx("span",{children:"Перенести"}),e.jsx("i",{className:"icon icon_move"})]}),e.jsxs("button",{onClick:ne,className:`button button_small button_dark ${g?"":"single"} ${S?"":"disabled"}`,title:"Скопировать комплект в другой проект/помещение",children:[e.jsx("span",{children:"Скопировать"}),e.jsx("i",{className:"icon icon_copy"})]}),g&&e.jsxs("button",{onClick:se,title:"Удалить комплект",className:"button button_small button_dark",children:[e.jsx("span",{children:"Удалить"}),e.jsx("i",{className:"icon icon_basket"})]})]})}),e.jsx("td",{children:e.jsxs("div",{id:c===0&&k===0?"step_23":void 0,className:qe,children:[g&&e.jsx("button",{className:s.count===1||s.count===0?`${O} ${q}`:O,onClick:()=>L(-1)}),e.jsx("input",{type:"text",className:g?"":Oe,value:s.count===0?"":s.count,onChange:ee,onBlur:te}),g&&e.jsx("button",{className:s.count===0?`${W} ${q}`:W,onClick:()=>L(1)})]})}),e.jsxs("td",{children:[re(s)," р."]})]})})]})]},`${s.id}-${k}`))}),h},He=(t,n,o,i,l,r,u,m,j,x,d,f,b)=>{const v=[],_=t.rooms;return!_||_&&_.length===0?null:(_.forEach((c,h)=>{const s=ze(c.configurations,t.id,c.id,n,o,i,l,r,u,m,j,x,d,t.localProject,t.token,h),k=me({rooms:b,roomId:c.id});v.push(e.jsxs("div",{className:Te,children:[e.jsxs("h3",{className:H,children:[e.jsx("span",{id:h===0?"step_18":void 0,children:c.name}),!k&&e.jsx(V,{cbf:()=>f("room",!0,c.name,t.id,c.id),size:"medium",title:"Переименовать помещение"})]}),e.jsx("ul",{id:h===0&&h===0?"step_21":void 0,className:Be,children:s})]},`${c.id}-${h}`))}),v)},Ge=({project:t})=>{var _;const[n,o,i,l,r,u,m,j,x,d,f,b]=M(c=>[c.setConfigurationCount,c.removeConfiguration,c.modalCopyConfigurationSet,c.setCurrentConfiguration,c.setEditConfiguration,c.getCountOfPosts,c.setSingleBordersFilter,c.setSingleDevicesFilter,c.setEditSketch,c.setEditBackground,c.modalRenameProjectRoomSet,c.rooms]),v=He(t,n,o,i,l,r,u,m,j,x,d,f,b);return t&&!((_=t.rooms)!=null&&_.length)?e.jsxs("div",{className:F,children:[e.jsx("h3",{className:H,children:"В проект не добавлено ни одного комплекта!"}),e.jsxs("ul",{className:Re,children:[e.jsx("li",{children:"Перейдите на вкладку Конфигуратор;"}),e.jsx("li",{children:"Добавьте Рамку и Устройство на холст;"}),e.jsx("li",{children:"Выберите Проект и Помещение;"}),e.jsx("li",{children:"Кликните Добавить в проект, чтобы добавить комплект."})]})]}):e.jsx("div",{className:F,children:v})},Ie="_text_bk6nq_1",Je="_tooltip_bk6nq_15",Ke="_show_bk6nq_68",Qe={text:Ie,tooltip:Je,show:Ke},{text:Ue,tooltip:Xe,show:Ye}=Qe,Q=({price:t})=>{const n=p.useRef(null),[o,i]=p.useState(!1),l=()=>{window.innerWidth<=1200&&i(!o)},r=p.useCallback(m=>{if(!n.current)return;const j=m.target;n.current.contains(j)||i(!1)},[]),u=p.useCallback(()=>i(!1),[]);return p.useEffect(()=>(window.addEventListener("scrollend",u),document.addEventListener("click",r),()=>{window.removeEventListener("scrollend",u),document.removeEventListener("click",r)}),[u,r]),e.jsxs("span",{ref:n,className:Ue,onClick:l,children:[t," р.",e.jsx("mark",{className:`${Xe} ${o?Ye:""}`,children:"Цена товара изменилась"})]})},Ze="_text_c3fsw_1",et="_tooltip_c3fsw_25",tt="_show_c3fsw_64",st={text:Ze,tooltip:et,show:tt},{text:ot,tooltip:nt,show:it}=st,U=()=>{const t=p.useRef(null),[n,o]=p.useState(!1),i=()=>{window.innerWidth<=1200&&o(!n)},l=p.useCallback(u=>{if(!t.current)return;const m=u.target;t.current.contains(m)||o(!1)},[]),r=p.useCallback(()=>o(!1),[]);return p.useEffect(()=>(window.addEventListener("scrollend",r),document.addEventListener("click",l),()=>{window.removeEventListener("scrollend",r),document.removeEventListener("click",l)}),[r,l]),e.jsxs("span",{ref:t,className:ot,onClick:i,children:["нет в наличии",e.jsx("mark",{className:`${nt} ${n?it:""}`,children:"Будет удален при редактировании, переносе и копировании комплекта"})]})},ct="_wrap_yuavj_14",lt="_wrapCenter_yuavj_22",rt="_caption_yuavj_31",at="_title_yuavj_40",dt="_subtitle_yuavj_48",ut="_body_yuavj_105",mt="_footer_yuavj_111",_t="_actions_yuavj_126",ht="_total_yuavj_144",jt="_shine_yuavj_1",pt={wrap:ct,wrapCenter:lt,caption:rt,title:at,subtitle:dt,body:ut,footer:mt,actions:_t,total:ht,"image-failed":"_image-failed_yuavj_1",shine:jt},{wrap:xt,wrapCenter:bt,caption:vt,title:ft,subtitle:gt,body:$t,footer:kt,actions:Ct,total:Nt}=pt,w=window.userToken,wt=(t,n,o,i,l,r,u)=>t?e.jsxs("ul",{id:"step_19",className:Ct,children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>n(t.id),className:"button button_dark",title:"Поделиться проектом",children:e.jsx("i",{className:"icon icon_share"})})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>l({project:t,filename:le(t.name,t.id)}),className:"button button_dark",title:"Скачать проект как PDF файл",children:e.jsx("i",{className:"icon icon_down"})})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>i(!0,""),className:"button button_dark",title:"Загрузить проект по ссылке",children:e.jsx("i",{className:"icon icon_upload"})})}),(t.token===null||t.token!==w)&&e.jsx("li",{children:e.jsx("button",{onClick:()=>r(t.id,w),className:"button button_dark",title:`Скопировать проект себе${w?"":" локально"}`,children:e.jsx("i",{className:"icon icon_copy"})})}),(t.localProject||t.token&&t.token===w)&&e.jsx("li",{children:e.jsx("button",{onClick:()=>t.localProject?u(t.id,t.name):o(t.id,t.name),className:"button button_dark",title:t.localProject?"Удалить локальный проект":"Удалить проект",children:e.jsx("i",{className:"icon icon_basket"})})})]}):null,yt=t=>{const n=[];return t.rooms?(t.rooms.forEach(o=>{o.configurations.forEach(i=>{const l=i.border,r=i.devices;l&&n.push({type:"border",article:l.article,count:i.count}),r&&r.length&&z(r).forEach(m=>{n.push({type:"device",article:m.article,count:m.selectedCount*i.count})})})}),ue(n)):n},Rt=()=>{var c,h;const[t,n,o,i,l,r,u,m,j,x]=M(s=>[s.projects,s.setActiveViewportTab,s.removeProject,s.shareProject,s.modalLoadProjectSet,s.setDownloadProject,s.addProductsToCart,s.copyProject,s.removeLocalProject,s.modalRenameProjectRoomSet]),d=t.filter(s=>s.edit)[0],f=wt(d,i,o,l,r,m,j),b=de(d);let v="button button_dark button_block";d&&!((c=d.rooms)!=null&&c.length)&&(v+=" disabled");const _=()=>{u(yt(d))};return d?e.jsxs("div",{className:xt,children:[e.jsxs("h2",{className:vt,children:[e.jsx("span",{id:"step_17",children:d.name}),d.token===w&&e.jsx(V,{cbf:()=>x("project",!0,d.name,d.id,null),size:"medium",title:"Переименовать проект"})]}),e.jsx("div",{className:$t,children:e.jsx(Ge,{project:d})}),e.jsxs("footer",{className:kt,children:[f,e.jsxs("div",{id:"step_20",className:Nt,children:[d&&((h=d.rooms)==null?void 0:h.length)&&b!==0&&e.jsxs("p",{children:[e.jsx("span",{children:"Общая стоимость:"}),e.jsxs("strong",{children:[y(b)," р."]})]}),e.jsx("button",{onClick:_,className:`${v}${b===0?" disabled":""}`,children:"Добавить в корзину"})]})]})]}):e.jsxs("div",{className:bt,children:[e.jsx("h2",{className:ft,children:"Вначале необходимо выбрать проект"}),e.jsxs("p",{className:gt,children:["Перейдите на вкладку ",e.jsx("button",{onClick:()=>n("hub"),children:"Мои проекты"})," и кликните по иконке ",e.jsxs("span",{children:[e.jsx("i",{})," (Редактировать)"]})," одного из проектов."]})]})};export{Rt as default};
