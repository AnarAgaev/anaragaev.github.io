function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,a,c,i=[],s=!0,d=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=a.call(r)).done)&&(i.push(n.value),i.length!==e);s=!0);}catch(t){d=!0,o=t}finally{try{if(!s&&null!=r.return&&(c=r.return(),Object(c)!==c))return}finally{if(d)throw o}}return i}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _createForOfIteratorHelper(t,e){var r,n,o,a,c="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(c)return o=!(n=!0),{s:function(){c=c.call(t)},n:function(){var t=c.next();return n=t.done,t},e:function(t){o=!0,r=t},f:function(){try{n||null==c.return||c.return()}finally{if(o)throw r}}};if(Array.isArray(t)||(c=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length)return c&&(t=c),a=0,{s:e=function(){},n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _regeneratorRuntime(){_regeneratorRuntime=function(){return c};var s,c={},t=Object.prototype,d=t.hasOwnProperty,l=Object.defineProperty||function(t,e,r){t[e]=r.value},e="function"==typeof Symbol?Symbol:{},n=e.iterator||"@@iterator",r=e.asyncIterator||"@@asyncIterator",o=e.toStringTag||"@@toStringTag";function a(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{a({},"")}catch(s){a=function(t,e,r){return t[e]=r}}function i(t,e,r,n){var o,a,c,i,e=e&&e.prototype instanceof v?e:v,e=Object.create(e.prototype),n=new k(n||[]);return l(e,"_invoke",{value:(o=t,a=r,c=n,i=m,function(t,e){if(i===h)throw Error("Generator is already running");if(i===f){if("throw"===t)throw e;return{value:s,done:!0}}for(c.method=t,c.arg=e;;){var r=c.delegate;if(r){r=function t(e,r){var n=r.method,o=e.iterator[n];if(o===s)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=s,t(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),_;n=u(o,e.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,_;o=n.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=s),r.delegate=null,_):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,_)}(r,c);if(r){if(r===_)continue;return r}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if(i===m)throw i=f,c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);i=h;r=u(o,a,c);if("normal"===r.type){if(i=c.done?f:p,r.arg===_)continue;return{value:r.arg,done:c.done}}"throw"===r.type&&(i=f,c.method="throw",c.arg=r.arg)}})}),e}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}c.wrap=i;var m="suspendedStart",p="suspendedYield",h="executing",f="completed",_={};function v(){}function y(){}function b(){}var e={},g=(a(e,n,function(){return this}),Object.getPrototypeOf),g=g&&g(g(T([]))),S=(g&&g!==t&&d.call(g,n)&&(e=g),b.prototype=v.prototype=Object.create(e));function L(t){["next","throw","return"].forEach(function(e){a(t,e,function(t){return this._invoke(e,t)})})}function w(c,i){var e;l(this,"_invoke",{value:function(r,n){function t(){return new i(function(t,e){!function e(t,r,n,o){var a,t=u(c[t],c,r);if("throw"!==t.type)return(r=(a=t.arg).value)&&"object"==_typeof(r)&&d.call(r,"__await")?i.resolve(r.__await).then(function(t){e("next",t,n,o)},function(t){e("throw",t,n,o)}):i.resolve(r).then(function(t){a.value=t,n(a)},function(t){return e("throw",t,n,o)});o(t.arg)}(r,n,t,e)})}return e=e?e.then(t,t):t()}})}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function T(e){if(e||""===e){var r,t=e[n];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return r=-1,(t=function t(){for(;++r<e.length;)if(d.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=s,t.done=!0,t}).next=t}throw new TypeError(_typeof(e)+" is not iterable")}return l(S,"constructor",{value:y.prototype=b,configurable:!0}),l(b,"constructor",{value:y,configurable:!0}),y.displayName=a(b,o,"GeneratorFunction"),c.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,a(t,o,"GeneratorFunction")),t.prototype=Object.create(S),t},c.awrap=function(t){return{__await:t}},L(w.prototype),a(w.prototype,r,function(){return this}),c.AsyncIterator=w,c.async=function(t,e,r,n,o){void 0===o&&(o=Promise);var a=new w(i(t,e,r,n),o);return c.isGeneratorFunction(e)?a:a.next().then(function(t){return t.done?t.value:a.next()})},L(S),a(S,o,"Generator"),a(S,n,function(){return this}),a(S,"toString",function(){return"[object Generator]"}),c.keys=function(t){var e,r=Object(t),n=[];for(e in r)n.push(e);return n.reverse(),function t(){for(;n.length;){var e=n.pop();if(e in r)return t.value=e,t.done=!1,t}return t.done=!0,t}},c.values=T,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=s,this.done=!1,this.delegate=null,this.method="next",this.arg=s,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&d.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=s)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function t(t,e){return a.type="throw",a.arg=r,n.next=t,e&&(n.method="next",n.arg=s),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var o=this.tryEntries[e],a=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var c=d.call(o,"catchLoc"),i=d.call(o,"finallyLoc");if(c&&i){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!i)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&d.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}var a=(o=o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc?null:o)?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,_):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),_},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),O(r),_}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r,n,o=this.tryEntries[e];if(o.tryLoc===t)return"throw"===(r=o.completion).type&&(n=r.arg,O(o)),n}throw Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:T(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=s),_}},c}function asyncGeneratorStep(t,e,r,n,o,a,c){try{var i=t[a](c),s=i.value}catch(t){return void r(t)}i.done?e(s):Promise.resolve(s).then(n,o)}function _asyncToGenerator(i){return function(){var t=this,c=arguments;return new Promise(function(e,r){var n=i.apply(t,c);function o(t){asyncGeneratorStep(n,e,r,o,a,"next",t)}function a(t){asyncGeneratorStep(n,e,r,o,a,"throw",t)}o(void 0)})}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return("string"===e?String:Number)(t);r=r.call(t,e||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){var r;if(t)return"string"==typeof t?_arrayLikeToArray(t,e):"Map"===(r="Object"===(r={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}window.debounce=function(r,n){var o;return function(){var t=this,e=arguments;clearTimeout(o),o=setTimeout(function(){r.apply(t,e)},n)}},window.formatDate=function(t){var e,r,t=new Date(t);return isNaN(t.getTime())?"":(e=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),t=t.getFullYear(),"".concat(e,".").concat(r,".").concat(t))},window.formatNumber=function(t){t=t.toFixed(2);return parseFloat(t.replace(/\s/g,"").replace(/,/g,".")).toLocaleString("ru").toString()},window.smoothScrollToElement=function(t){var r,n,o;t?(t=t.getBoundingClientRect().top+window.scrollY-20,n=t-(r=window.scrollY),o=null,requestAnimationFrame(function t(e){e-=o=o||e,e=Math.min(e/300,1);window.scrollTo(0,r+n*e),e<1&&requestAnimationFrame(t)})):console.warn("На странице нет элемента к которому нужно проскролить экран.")},window.throttle=function(t,e){var r,n,o=!1;function a(){o?(r=arguments,n=this):(t.apply(this,arguments),o=!0,setTimeout(function(){o=!1,r&&(a.apply(n,r),r=n=null)},e))}return a},window.validateEmail=function(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)},window.validatePhone=function(t){return/^7\d{10}$/.test(t)};var FOOTER_HIDDEN_OFFSET=50,initBackToOrdersButton=function(){var r=document.getElementById("backToOrdersButton"),n=document.getElementById("footer");function t(){var t=r.getBoundingClientRect(),e=n.getBoundingClientRect(),t=t.bottom;e.top-FOOTER_HIDDEN_OFFSET<=t?r.classList.add("hidden"):r.classList.remove("hidden")}r&&n&&(window.addEventListener("scroll",t),t())};function initializingFavoriteButtons(){var t=document.querySelectorAll(".card-top__btn_favorite"),e=document.querySelectorAll(".card-product__actions-item_favorite i"),r=document.querySelectorAll("#fastView .modal__slider-card-favorite"),t=[].concat(_toConsumableArray(Array.from(t)),_toConsumableArray(Array.from(e)),_toConsumableArray(Array.from(r)));0!==t.length&&t.forEach(function(t){t.hasAttribute("data-inited")||(t.dataset.inited="",new FavoriteButton(t).init())})}document.addEventListener("DOMContentLoaded",initBackToOrdersButton),window.addEventListener("load",function(){initializingFavoriteButtons()});var FavoriteButton=function(){return _createClass(function t(e){_classCallCheck(this,t),this.button=e,this.clickHandler=this.clickHandler.bind(this)},[{key:"init",value:function(){var e=this;this.button.addEventListener("click",function(t){t.preventDefault(),e.clickHandler()})}},{key:"clickHandler",value:function(){var t=this.button.classList.contains("checked"),e=this.checkErrors();e.isError?e.errors.forEach(function(t){return console.error(t)}):this.request(t?"remove":"add")}},{key:"checkErrors",value:function(){var t=!1,e=[];return this.button.dataset.id||(t=!0,e.push("Не указан id продукта в обработчике добавления/удаления товара в Избранное!")),window.addToFavoriteLink||(t=!0,e.push("Некорректный URL API добавить товар в Избранное! (window.addToFavoriteLink)")),window.removeFromFavoriteLink||(t=!0,e.push("Некорректный URL API удалить товар из Избранного! (window.removeFromFavoriteLink)")),{isError:t,errors:e}}},{key:"request",value:(e=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){var r,n,o,a;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.button.dataset.id,n="add"===e?window.addToFavoriteLink:window.removeFromFavoriteLink,(a=new FormData).append("product",r),this.button.classList.add("blocked"),t.prev=5,t.next=8,fetch(n,{method:"POST",body:a,credentials:"include"});case 8:if((o=t.sent).ok){t.next=12;break}throw a="Ошибка запроса ".concat("add"===e?"добавления":"удаления"," товара ").concat("add"===e?"в Избранное":"из Избранного","! API URL: ").concat(n),new Error(a);case 12:return t.next=14,o.json();case 14:if("error"===t.sent.status)throw new Error("Не получилось добавить товар id: ".concat(r," в Избранное! API URL: ").concat(n));t.next=17;break;case 17:"add"===e?this.button.classList.add("checked"):this.button.classList.remove("checked"),console.log("this.button.classList.add",this.button),"remove"===e&&this.removeParentCard(),t.next=25;break;case 22:t.prev=22,t.t0=t.catch(5),console.error(t.t0);case 25:return t.prev=25,this.button.classList.remove("blocked"),t.finish(25);case 28:case"end":return t.stop()}},t,this,[[5,22,25,28]])})),function(t){return e.apply(this,arguments)})},{key:"removeParentCard",value:function(){var t=this.button.closest(".favorite__item");t&&t.remove()}}]);var e}();function showOrderWar(t,e){var r,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,o=document.querySelector(t);o&&(e&&(o.querySelector(".order-war__order-number").innerText="№ "+e),n&&"string"==typeof n.order_url&&(o.querySelector("a.order_url").href=n.order_url),r=o.querySelector(".order-war__body"),o.classList.add("visible"),setTimeout(function(){o.classList.add("show"),r.classList.add("visible")},10))}function hideOrderWar(t){var e=document.querySelector(t);e&&((t=e.querySelector(".order-war__order-number"))&&(t.innerText=""),e.querySelector(".order-war__body").classList.remove("visible"),e.classList.remove("show"),setTimeout(function(){return e.classList.remove("visible")},300))}function initOrderLoggedWar(){var t=document.querySelector("#orderLoggedWar");t&&(t.querySelector(".close").addEventListener("click",function(){return hideOrderWar("#orderLoggedWar")}),document.addEventListener("click",function(t){t.target.closest(".order-war__body")||hideOrderWar("#orderLoggedWar")}))}function initAddProductWar(){var t=document.querySelector("#orderAddProductWar");t&&(t.querySelector(".close").addEventListener("click",function(){return hideOrderWar("#orderAddProductWar")}),t.querySelector("button").addEventListener("click",function(){addProductToOrder(),hideOrderWar("#orderAddProductWar")}),document.addEventListener("click",function(t){t.target.closest(".order-war__body")||hideOrderWar("#orderAddProductWar")}))}function initRequestErr(){var t=document.querySelector("#orderError");t&&(t.querySelectorAll(".close").forEach(function(t){return t.addEventListener("click",function(){return hideOrderWar("#orderError")})}),document.addEventListener("click",function(t){t.target.closest(".order-war__body")||hideOrderWar("#orderError")}))}function initRequestApproved(){var t=document.querySelector("#orderApproved");t&&(t.querySelectorAll(".close").forEach(function(t){return t.addEventListener("click",function(){return hideOrderWar("#orderApproved")})}),document.addEventListener("click",function(t){t.target.closest(".order-war__body")||hideOrderWar("#orderApproved")}))}function initAddProductNewOrder(){var t=document.querySelector("#orderAddProductNewOrder");t&&(t.querySelector(".close").addEventListener("click",function(){return hideOrderWar("#orderAddProductNewOrder")}),t.querySelector("button").addEventListener("click",function(){addProductToOrder(),hideOrderWar("#orderAddProductNewOrder")}),document.addEventListener("click",function(t){t.target.closest(".order-war__body")||hideOrderWar("#orderAddProductNewOrder")}))}function initFastView(){var t;document.querySelector(".catalog_iframe")||0!==(t=document.querySelectorAll("._js-open-fast-view")).length&&t.forEach(function(r){r.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),showOrderWar("#fastView"),getCardDetails(r),initModalQuantityChanger();var e,t=r.closest(".card-product");t?(t=t.dataset.buyWith,e=null==(e=document.getElementById("fastView"))?void 0:e.querySelector(".modal__slider-body h3"),t?(e&&(e.style.display="block"),requestBuyWithProduct(t)):(e&&(e.style.display="none"),console.error("У товара не указана ссылка на Рекомендованные товары в data-аттрибуте [data-buy-with]"))):console.error("У кнопки отсутствует родительская карточка")})})}function hideFastView(){var t=document.querySelector("#fastView");t&&(t.querySelector(".close").addEventListener("click",function(){return hideOrderWar("#fastView")}),t.querySelector("._js-modal-add").addEventListener("click",function(){hideOrderWar("#fastView")}),document.addEventListener("click",function(t){t.target.closest(".order-war__body")||hideOrderWar("#fastView")}))}function initModalQuantityChanger(){var e=document.querySelector("#fastView ._js-modal-quantity"),t=document.querySelector("#fastView .changer__btn_minus"),r=document.querySelector("#fastView .changer__btn_plus"),n=Number(e.value);function o(t){n=Math.max(1,t),e.value=n,gettingTheFullCost()}t.addEventListener("click",function(){return o(n-1)}),r.addEventListener("click",function(){return o(n+1)}),e.addEventListener("change",function(){var t=parseInt(e.value,10);o(isNaN(t)||t<1?1:t)})}function gettingTheFullCost(){var t,e=document.querySelector("._js-modal-price");e&&(e=e.textContent.replace(/\s/g,""),t=document.querySelector("._js-modal-quantity").value,e=parseFloat(e.replace(/,/g,"."))*parseFloat(t),document.querySelector("._js-modal-total").innerHTML=e?e.toLocaleString("ru"):"0")}function getCardDetails(t){function e(t,e){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=e.closest(".card-top__price-item");t?(e.innerHTML=parseFloat(t.replace(/,/g,".")).toLocaleString("ru"),null!=n&&n.classList.remove("hidden")):null!=n&&n.classList.add("hidden"),r?null!=n&&n.classList.add("card-top__price_crossed"):null!=n&&n.classList.remove("card-top__price_crossed")}var t=t.closest("._js-card-product"),r=t.dataset.id,n=t.dataset.image,o=t.dataset.title,a=t.dataset.article,c=t.dataset.stock,i=t.dataset.rrc_price,s=t.dataset.price_sale,d=t.dataset.opt_price,l=Boolean(t.dataset.sale),u=Boolean(t.dataset.rec_showed),m=Boolean(t.dataset.opt_showed),t=parseInt(t.querySelector("._js-card-quantity").value),p=document.querySelector("._js-modal-add"),h=document.querySelector("._js-modal-image"),f=document.querySelector("._js-modal-name"),_=document.querySelector("._js-modal-code"),v=document.querySelector("._js-modal-count"),y=document.querySelector("._js-modal-price-rrc"),b=document.querySelector("._js-modal-price-sale"),g=document.querySelector("._js-modal-price"),S=document.querySelector("._js-modal-quantity"),L=document.querySelector("._js-modal-total");p.dataset.productId=r,h.src=n,f.textContent=o,_.textContent=a,v.innerHTML=c,S.value=t,L.innerHTML=(Number(parseFloat((null!=(r=null!=(p=null!=d?d:s)?p:i)?r:"0").replace(/,/g,".")))*parseFloat(t)).toLocaleString("ru");u?l?(e(i,y,!0),e(s,b)):(e(i,y),e(!1,b)):(e(!1,y),e(!1,b)),e(!(!m||!d)&&d,g)}function initSuccess(){var t=document.querySelector("#success");t&&(t.querySelector(".close").addEventListener("click",function(){return hideOrderWar("#success")}),t.querySelector("button").addEventListener("click",function(){hideOrderWar("#success")}),document.addEventListener("click",function(t){t.target.closest(".order-war__body")||hideOrderWar("#success")}))}var buyWithProductModalSwiper=void 0;function requestBuyWithProduct(t){return _requestBuyWithProduct.apply(this,arguments)}function _requestBuyWithProduct(){return(_requestBuyWithProduct=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){var r,n,o,a,c,i;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=window.addProductApiLink,r=null==(r=document.getElementById("fastView"))?void 0:r.querySelector(".modal__slider-body h3"),a){t.next=8;break}return r&&(r.style.display="none"),console.error("Не корректный api url для добавления товара в заказ. Слайдер с рекомендованными товарами в модальном окне быстрого просмотре не будет отрисован."),t.abrupt("return");case 8:r&&(r.style.display="block");case 9:if(n=document.querySelector("#fastView")){t.next=12;break}return t.abrupt("return");case 12:if(o=n.querySelector(".modal__slider")){t.next=15;break}return t.abrupt("return");case 15:return t.prev=15,o.classList.add("pending"),o.classList.remove("fulfilled","rejected"),t.next=20,fetch(e);case 20:if((c=t.sent).ok){t.next=23;break}throw new Error("Ошибка запроса к API: С этим товаром покупают");case 23:return t.next=25,c.json();case 25:if(null!=(i=t.sent)&&null!=(a=i.data)&&a.length){t.next=28;break}throw new Error("В ответе сервера нет ни одного рекомендованного товара. Слайдер с рекомендованными товарами в модальном окне быстрого просмотре не будет отрисован.");case 28:setTimeout(function(){initModalSwiper(i.data,n),o.classList.remove("pending"),o.classList.add("fulfilled")},2e3),t.next=37;break;case 31:t.prev=31,t.t0=t.catch(15),o.classList.remove("pending"),o.classList.add("rejected"),r&&(r.style.display="none"),console.error(t.t0);case 37:case"end":return t.stop()}},t,null,[[15,31]])}))).apply(this,arguments)}function initModalSwiper(t,e){var a;console.log("Products for Slider in Fast view modal",t),t||t.length||e?(buyWithProductModalSwiper&&buyWithProductModalSwiper.destroy(!0,!0),(a=e.querySelector("#buyWithProductList")).replaceChildren(),t.forEach(function(t){var e=document.createElement("div"),r=(e.className="swiper-slide modal__slider-slide",t.price.rrc_price?parseFloat(t.price.rrc_price.toString().replace(/\s/g,"").replace(/,/g,".")).toLocaleString("ru"):void 0),n=t.price.sale_price?parseFloat(t.price.sale_price.toString().replace(/\s/g,"").replace(/,/g,".")).toLocaleString("ru"):void 0,o=t.price.opt_price?parseFloat(t.price.opt_price.toString().replace(/\s/g,"").replace(/,/g,".")).toLocaleString("ru"):void 0;e.innerHTML='\n\t\t\t<div class="modal__slider-card">\n\n\t\t\t\t<div class="spnr">\n\t\t\t\t\t<svg class="spnr-svg" viewBox="0 0 50 50">\n\t\t\t\t\t\t<circle class="path" cx="25" cy="25" r="20"></circle>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\n\t\t\t\t'.concat("true"===t.new?'<mark class="modal__slider-card-new">new</mark>':"",'\n\n\t\t\t\t<i class="modal__slider-card-picture">\n\t\t\t\t\t<img src="').concat(t.image,'" alt="').concat(t.title,'" loading="lazy">\n\t\t\t\t</i>\n\n\t\t\t\t<div class="modal__slider-card-body">\n\t\t\t\t\t<div class="modal__slider-card-caption">\n\t\t\t\t\t\t<a href="').concat(t.url,'" title="').concat(t.title,'" target="_blank">\n\t\t\t\t\t\t\t<strong>').concat(t.title,"</strong>\n\t\t\t\t\t\t\t<span>").concat(t.article,'</span>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<button type="button" class="modal__slider-card-favorite ').concat(t.favorite?"checked":"",'" data-id="').concat(t.id,'"></button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t').concat(t.in_stock?'<div class="modal__slider-card-stock">'.concat(t.in_stock,"</div>"):"",'\n\n\t\t\t\t\t<div class="modal__slider-card-price">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t').concat(r?"<span>РРЦ: ".concat(n?'<span class="crossed">'.concat(r,"</span> р."):"".concat(r," р."),"</span>"):"","\n\t\t\t\t\t\t\t").concat(n?"<span>РРЦ распродажа: ".concat(n," р.</span>"):"","\n\t\t\t\t\t\t\t").concat(o?"<p>Ваша цена: ".concat(o," р.</p>"):"",'\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<button type="button" class="modal__slider-card-buy" data-id="').concat(t.id,'">\n\t\t\t\t\t\t\t<div class="modal__slider-tooltip">\n\t\t\t\t\t\t\t\t<div class="modal__slider-tooltip-body">\n\t\t\t\t\t\t\t\t\t<span>Добавить в заказ</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'),a.appendChild(e)}),(t=e.querySelector(".swiper"))&&(buyWithProductModalSwiper=new Swiper(t,{loop:!1,slidesPerView:"auto",observer:!0,observeParents:!0,observeSlideChildren:!0,watchOverflow:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},on:{init:function(){initializingFavoriteButtons(),initButtonsAddToOrderForBuyWithProduct()}}}))):console.error("Слайдер в карточке быстрого просмотра не построен. Отсутствуют либо список товаров либо модальный попап быстрого просмотра!")}function initButtonsAddToOrderForBuyWithProduct(){function e(){return(e=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){var r,n,o,a,c,i,s,d,l,u,m,p;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.closest(".modal__slider-card")){t.next=3;break}return t.abrupt("return");case 3:if(n=e.dataset.id,o=null==(a=e.closest("#fastView"))||null==(a=a.querySelector(".custom-select__value"))||null==(a=a.dataset)?void 0:a.orderId,t.prev=5,a=window.addProductApiLink){t.next=9;break}throw new Error("Не корректный api url для добавления товара!");case 9:u=new FormData,o&&"undefined"!==o&&u.append("order",o),u.append("product",n),u.append("count",1),r.classList.add("pending"),c={},i=_createForOfIteratorHelper(u.entries());try{for(i.s();!(s=i.n()).done;)d=s.value,c[d[0]]=d[1]}catch(t){i.e(t)}finally{i.f()}return console.log("Add product Request:",c),t.next=20,fetch(a,{method:"POST",body:u,credentials:"include"});case 20:if((l=t.sent).ok){t.next=23;break}throw new Error("Ошибка добавления товара из карточки быстрого просмотра!");case 23:return t.next=25,l.json();case 25:m=(u=t.sent).data.number||u.data.number_1c||u.data.id,p=window.formatDate(u.data.meta.created_at),setTimeout(function(){r.classList.remove("pending"),r.classList.add("response"),r.dataset.result=o&&"undefined"!==o?"Добавили товар в заказ ".concat(m," от ").concat(p):"Создали для товара новый заказ ".concat(m," и добавили в него товар"),setTimeout(function(){r.classList.remove("response"),r.removeAttribute("result")},3e3),getListOrders()},1e3),"function"==typeof initOrders&&initOrders(!0),t.next=39;break;case 32:t.prev=32,t.t0=t.catch(5),console.error(t.t0),r.classList.remove("pending"),r.classList.add("response"),r.dataset.result="Не получилось добавить товар в заказ. Попробуйте немного позже.",setTimeout(function(){r.classList.remove("response"),r.removeAttribute("result")},3e3);case 39:case"end":return t.stop()}},t,null,[[5,32]])}))).apply(this,arguments)}document.querySelector("#buyWithProductList").querySelectorAll(".modal__slider-card-buy").forEach(function(t){return t.addEventListener("click",function(){return function(){return e.apply(this,arguments)}(t)})})}function initAddProductBtn(){var t=document.querySelectorAll(".card-top__btn_order");0!==t.length&&t.forEach(function(r){r.addEventListener("click",function(t){var e=!!t.target.closest("#fastView");ADD_PRODUCT_TO_ORDER_FROM=e?"modal":"card",t.stopPropagation(),null===r.getAttribute("data-product-id")?showOrderWar("#orderLoggedWar"):checkAddProductButton(r)})})}window.addEventListener("load",function(){initOrderLoggedWar(),initAddProductWar(),initRequestErr(),initRequestApproved(),initAddProductNewOrder(),initFastView(),hideFastView(),gettingTheFullCost(),initSuccess(),initAddProductBtn()});var GET_ORDERS_LINK=window.listOrders,ORDERS_NODE=document.getElementById("orders"),ORDERS_LOADER=document.getElementById("ordersLoader"),ORDERS_LIST=[],NEXT_ORDERS_PAGE=null,IS_ORDERS_LOADING=!1;function initOrders(t){return _initOrders.apply(this,arguments)}function _initOrders(){return(_initOrders=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){var r,n,o,a;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(ORDERS_NODE){t.next=2;break}return t.abrupt("return");case 2:if(ORDERS_NODE.classList.remove("initialized"),t.prev=3,GET_ORDERS_LINK){t.next=6;break}throw new Error("Ошибка инициализации шторки Все заказы. Не указан url получения списка заказов window.listOrders Текущее значение",GET_ORDERS_LINK);case 6:return t.next=8,fetch(GET_ORDERS_LINK);case 8:if((n=t.sent).ok){t.next=11;break}throw new Error("Ошибка запроса Заказов. Шторка Все заказы не проинициализирована.");case 11:return t.next=13,n.json();case 13:o=t.sent,console.log("ordersData",o),null!=o&&null!=(r=o.data)&&r.length&&(ORDERS_NODE&&ORDERS_NODE.classList.add("initialized"),ORDERS_LIST=_toConsumableArray(o.data),e&&(document.querySelector("#orders .custom-select__list").innerHTML=""),addItemsToTheOrdersList(o.data),a=sessionStorage.getItem("selected-order-id"))&&updateSelectedOrderList(ORDERS_LIST.filter(function(t){return String(t.id).toLocaleLowerCase()===a.toLocaleLowerCase()})),NEXT_ORDERS_PAGE=null!=(o=null==o||null==(r=o.links)?void 0:r.next)?o:null,e||(setToggleOrders(),setToggleOrdersSelector()),setLazyOrderAdd(),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(3),console.error(t.t0);case 24:case"end":return t.stop()}},t,null,[[3,21]])}))).apply(this,arguments)}function setToggleOrders(){var t;function e(){ORDERS_NODE.classList.toggle("visible");var t=document.querySelector("#orders .custom-select--open");t&&setTimeout(function(){return t.classList.remove("custom-select--open")},1e3)}ORDERS_NODE&&((t=ORDERS_NODE.querySelector(".orders__toggler"))&&t.addEventListener("click",e),(t=ORDERS_NODE.querySelector(".orders__close"))&&t.addEventListener("click",e),(t=ORDERS_NODE.querySelector(".go-next"))&&t.addEventListener("click",e),t=ORDERS_NODE.querySelector(".orders__back"))&&t.addEventListener("click",e)}function setToggleOrdersSelector(){var t=document.querySelector("#orders .custom-select__top");t&&t.addEventListener("click",function(){t.closest(".custom-select-order-selector").classList.toggle("custom-select--open")})}function setLazyOrderAdd(){var t=document.querySelector("#orders .custom-select__drop");t&&t.addEventListener("scroll",function(){t.scrollHeight-t.scrollTop-t.clientHeight<=10&&!IS_ORDERS_LOADING&&NEXT_ORDERS_PAGE&&ORDERS_LOADER&&(IS_ORDERS_LOADING=!0,ORDERS_LOADER.classList.add("visible"),setTimeout(loadNextPageOrders,1500))})}function loadNextPageOrders(){return _loadNextPageOrders.apply(this,arguments)}function _loadNextPageOrders(){return(_loadNextPageOrders=_asyncToGenerator(_regeneratorRuntime().mark(function t(){var e,r,n;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("NEXT_ORDERS_PAGE",NEXT_ORDERS_PAGE),t.prev=1,t.next=4,fetch(NEXT_ORDERS_PAGE);case 4:if((e=t.sent).ok){t.next=7;break}throw new Error("Ошибка запроса Заказов со следующей страницы. Запрашиваемый URL",NEXT_ORDERS_PAGE);case 7:return t.next=9,e.json();case 9:r=t.sent,console.log("Next page ordersData",r),null!=r&&null!=(n=r.data)&&n.length&&(r.data.forEach(function(t){return ORDERS_LIST.push(t)}),addItemsToTheOrdersList(r.data),(null==(n=document.querySelector('#orders input[data-id="all"]'))?void 0:n.checked)&&updateSelectedOrderList(ORDERS_LIST),checkSelectedItemFromSessionOrderId()),NEXT_ORDERS_PAGE=null!=(r=null==r||null==(n=r.links)?void 0:n.next)?r:null,ORDERS_LOADER&&ORDERS_LOADER.classList.remove("visible"),IS_ORDERS_LOADING=!1,t.next=20;break;case 17:t.prev=17,t.t0=t.catch(1),console.error(t.t0);case 20:case"end":return t.stop()}},t,null,[[1,17]])}))).apply(this,arguments)}function addItemsToTheOrdersList(t){var s;t?(s=document.querySelector("#orders .custom-select__list"),t.forEach(function(t){var e=document.createElement("li"),r=(e.className="custom-select__item",document.createElement("label")),n=(r.className="custom-select__option",document.createElement("input")),o=(n.className="invisible",n.type="checkbox",n.name="order-item",n.dataset.id="".concat(t.id),addClickHandlerTo(n),document.createElement("span")),a=(o.textContent="Заказ № ".concat(t.number_1c||""," ").concat(t.number||""),document.createElement("div")),c=document.createElement("i"),i=(c.textContent="от ".concat(null!=t&&null!=(i=t.meta)&&i.created_at?window.formatDate(t.meta.created_at):""),document.createElement("mark"));i.textContent=(null==t||null==(t=t.status)||null==(t=t.current)?void 0:t.label)||"",a.appendChild(c),a.appendChild(i),r.appendChild(n),r.appendChild(o),r.appendChild(a),e.appendChild(r),s.appendChild(e),checkSelectedItemFromSessionOrderId()})):console.error("Список заказов для шторки Ваша заказы - пуст. Текущее значение",t)}function addClickHandlerTo(e){e.addEventListener("click",function(t){updateOrderIdInSession(e),normalizeSelectedOrderList(t),e.checked&&(t=e.closest(".custom-select--open"))&&t.classList.remove("custom-select--open")})}function normalizeSelectedOrderList(t){var e,r,n=Array.from(document.querySelectorAll("#orders input"));n.length&&(e=(t=t.target).checked,t="all"===(r=t.dataset.id),e?(n.forEach(function(t){return t.dataset.id!==r&&(t.checked=!1)}),updateSelectedOrderList(t?ORDERS_LIST:ORDERS_LIST.filter(function(t){return String(t.id).toLocaleLowerCase()===r.toLocaleLowerCase()}))):updateSelectedOrderList([]))}function updateSelectedOrderList(o){var a,t,e,r,c=document.querySelector("#orders .orders__list");c&&(a=[],c.innerHTML="",o.forEach(function(t){var e=document.createElement("div"),r=(e.className="orders__item",null!=t&&null!=(r=t.meta)&&r.created_at?"от ".concat(window.formatDate(t.meta.created_at)):""),n=document.createElement("h3"),r=(n.textContent="Заказ № ".concat(t.number_1c||""," ").concat(t.number||""," ").concat(r),document.createElement("span")),r=(r.textContent="".concat(t.status.current.label),n.appendChild(r),e.appendChild(n),createProductList(t.products)),n=r.productsList,t=r.totalOrderSum;e.appendChild(n),1<o.length&&t&&((r=document.createElement("p")).textContent="Итого: ".concat(t.toLocaleString("ru-RU")," р."),e.appendChild(r)),a.push(t),c.appendChild(e)}),t=a.reduce(function(t,e){return t+e},0),null!=(e=document.querySelector("#orders .orders__total"))&&e.querySelector("mark"),r=null==e?void 0:e.querySelector("span"),0<t&&e&&r&&1===o.length?(r.innerText=window.formatNumber(t)+" р.",e.classList.add("visible")):e.classList.remove("visible"),checkListScrollbar())}function createProductList(t){var d,l=document.createElement("ul");return t.length?(d=0,t.forEach(function(t){var e=document.createElement("li"),r=document.createElement("div"),n=(r.className="data",document.createElement("div")),o=(n.className="text",document.createElement("i")),a=document.createElement("img"),a=(a.src=t.image||"",a.alt=t.title||"",o.appendChild(a),document.createElement("div")),c=document.createElement("p"),i=document.createElement("span"),i=(i.textContent=t.title||"Название товара не указано",c.appendChild(i),t.article&&((i=document.createElement("mark")).textContent=t.article,c.appendChild(i)),document.createElement("span")),s=t.price||0,c=(i.textContent="".concat(window.formatNumber(s)," р."),a.appendChild(c),a.appendChild(i),n.appendChild(o),n.appendChild(a),document.createElement("div")),i=(c.className="total",document.createElement("p")),o=(i.textContent="Количество",document.createElement("span")),a=t.count||0,t=(o.textContent="".concat(a," шт."),i.appendChild(o),document.createElement("p")),o=(t.textContent="Общая стоимость",document.createElement("span")),s=s*a,a=(o.textContent="".concat(window.formatNumber(s)," р."),t.appendChild(o),c.appendChild(i),c.appendChild(t),r.appendChild(n),r.appendChild(c),e.appendChild(r),document.createElement("div"));a.className="hr",e.appendChild(a),l.appendChild(e),d+=s}),{productsList:l,totalOrderSum:d}):((t=document.createElement("li")).textContent="В заказе нет товаров",l.appendChild(t),{productsList:l,totalOrderSum:0})}function checkListScrollbar(){var t=document.querySelector("#orders .orders__list");if(!t)return!1;t.scrollHeight>t.clientHeight?t.classList.add("scrolled"):t.classList.remove("scrolled")}function updateOrderIdInSession(t){var e=t.dataset.id;e?t.checked&&"all"!==e?sessionStorage.setItem("selected-order-id",e):sessionStorage.removeItem("selected-order-id"):console.error("У выбранного заказа не указано свойство Идентификатора [data-id]")}function checkSelectedItemFromSessionOrderId(){var e=sessionStorage.getItem("selected-order-id");e&&updateSelectedOrderList(ORDERS_LIST.filter(function(t){return String(t.id).toLocaleLowerCase()===e.toLocaleLowerCase()}))}function wrapSubstringInBold(t,e){e=new RegExp(e,"gi");return e.test(t)?t.replace(e,"<b>$&</b>"):t}function showSearchLoading(){document.querySelector("#loadingSearch").classList.add("visible")}function hideSearchLoading(){document.querySelector("#loadingSearch").classList.remove("visible")}function checkShowAllSearchResults(t,e,r){var n=document.getElementById("searchingShowAll"),o=n.querySelector("span"),a=(n.classList.remove("visible"),window.catalogLink);a?t<=e||(o.innerText="(".concat(t,")"),n.href="".concat(a,"?query=").concat(r),n.classList.add("visible")):console.error("Не корректный URL Показать все товары в поисковой выдаче!")}function checkSearchButton(t){var e=document.getElementById("searchButton"),r=window.catalogLink;e.removeAttribute("href"),r&&t&&(e.href="".concat(r,"?query=").concat(t))}window.addEventListener("load",function(){"function"==typeof initOrders&&initOrders();var t=document.querySelector('#orders input[data-id="all"]');t&&addClickHandlerTo(t)});var debouncedSearchRequest=window.debounce(_asyncToGenerator(_regeneratorRuntime().mark(function t(){var e,r,n,o;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=document.querySelector(".search__input"),""===(e=e.value.trim()))return document.querySelector("#searchingResults").classList.remove("success","fail"),checkSearchButton(),t.abrupt("return");t.next=7;break;case 7:if(!(3<=e.length)){t.next=29;break}if(t.prev=8,r=window.searchRequestLink){t.next=12;break}throw new Error("Не корректный URL API поиска!");case 12:return showSearchLoading(),r+=e,t.next=16,fetch(r);case 16:if((n=t.sent).ok){t.next=19;break}throw new Error("Ошибка запроса поиска!");case 19:return t.next=21,n.json();case 21:o=t.sent,console.log("Search API Response",o),updateSearchResult(e,o),t.next=29;break;case 26:t.prev=26,t.t0=t.catch(8),console.error("Search API Request -",t.t0);case 29:case"end":return t.stop()}},t,null,[[8,26]])})),700);function initSearching(){var t=document.querySelector(".search__reset"),e=document.querySelector(".search__input");e&&e.addEventListener("input",function(){""!==e.value?t.classList.add("visible"):t.classList.remove("visible"),debouncedSearchRequest()})}function updateSearchResult(r,t){var e=t.count,t=t.data,n=document.querySelector("#searchingResults"),o=n.querySelector("#searchingList");if(n.classList.remove("success","fail"),hideSearchLoading(),0===t.length)n.classList.add("fail");else{for(;o.firstChild;)o.removeChild(o.firstChild);var a="",c=t.filter(function(t){return t.is_absolute_match});(c.length?c:t).forEach(function(t){var e="";null!=t&&t.breadcrumbs.length&&t.breadcrumbs.forEach(function(t){e+='<li><a href="'.concat(t.url,'">').concat(t.name,"</a></li>")}),a+='\n\t\t\t<li>\n\t\t\t\t<div class="search__item">\n\t\t\t\t\t<a class="search__item-pic" href="'.concat(t.url,'">\n\t\t\t\t\t\t<i><img src="').concat(t.image,'" alt="').concat(t.title,'" /></i>\n\t\t\t\t\t</a>\n\t\t\t\t\t<div class="search__item-desc">\n\t\t\t\t\t\t<a href="').concat(t.url,'">').concat(wrapSubstringInBold(t.title,r),"</a>\n\t\t\t\t\t\t").concat(t.price.rrc_price||t.price.opt_price?"<em>\n\t\t\t\t\t\t\t\t<span>".concat(window.formatNumber(t.price.rrc_price||t.price.opt_price)," р.</span>\n\t\t\t\t\t\t\t\t").concat(t.in_stock,"\n\t\t\t\t\t\t\t</em>"):"",'\n\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="search__item-collection">\n\t\t\t\t\t\t<span>Коллекция</span>\n\t\t\t\t\t\t<a href="').concat(t.collection.url,'">').concat(t.collection.name,"</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t").concat(e?'\n\t\t\t\t\t\t\t<div class="search__item-breadcrumbs">\n\t\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t\t'.concat(e,"\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t"):"","\n\t\t\t\t</div>\n\t\t\t</li>\n\t\t")}),o.innerHTML=a,n.classList.add("success"),checkShowAllSearchResults(e,t.length,r),checkSearchButton(r)}}function initToggleMobileSearch(){var e=document.querySelector("#search"),r=document.querySelector("#mobileSearchToggler"),n=document.querySelector(".nav-mobile");e&&r&&n&&r.addEventListener("click",function(){var t=0;n.classList.contains("visible")&&(n.classList.remove("visible"),t=300),setTimeout(function(){e.classList.contains("visible")?resetSearch():(e.classList.add("visible"),r.classList.add("active"))},t)})}function initToggleMobileSearchToNav(){var t=document.querySelector(".search__burger"),e=document.querySelector(".nav-mobile");t&&e&&t.addEventListener("click",function(){resetSearch(),setTimeout(function(){return e.classList.add("visible")},300)})}function activeInactiveSearch(){var t=document.querySelector(".search__input");t&&t.addEventListener("focus",activateSearch)}function activateSearch(){window.innerWidth<1200||document.querySelector("#search").classList.add("active")}function resetSearch(){var t=document.querySelector("#searchingResults"),e=document.querySelector("#mobileSearchToggler"),r=document.querySelector("#search"),n=document.querySelector(".search__reset"),o=document.querySelector(".search__input");t.querySelector(".search__results").scrollTop=0,t.classList.remove("success","fail"),e.classList.remove("active"),r.classList.remove("visible"),r.classList.remove("active"),n.classList.remove("visible"),o.value="",o.blur(),hideSearchLoading(),checkSearchButton()}function initResetInputValue(){var t=document.querySelector("#resetSearchText"),e=document.querySelector(".search__back");t&&e&&(t.addEventListener("click",resetSearch),e.addEventListener("click",resetSearch))}window.addEventListener("scroll",function(){var t=document.getElementById("search");t&&t.classList.contains("active")&&100<window.scrollY&&resetSearch()}),window.addEventListener("load",function(){initSearching(),initResetInputValue(),initToggleMobileSearch(),initToggleMobileSearchToNav(),activeInactiveSearch()});var ShareLinks=function(){return _createClass(function t(e){_classCallCheck(this,t),this.node=e,this.links=JSON.parse(this.node.dataset.links),this.parent=this.node.parentNode,this.onDocument(),this.onWindow()},[{key:"init",value:function(){var e=this;this.parent.addEventListener("click",function(t){t.target.classList.contains("share-tooltip__link")||(e.parent.querySelector(".share-tooltip__list")?e.remove():(e.node.appendChild(e.createChildList()),e.show()))})}},{key:"createChildList",value:function(){var n=document.createElement("ul");return n.classList.add("share-tooltip__list"),this.links.forEach(function(t){var e=document.createElement("li"),r=(e.classList.add("share-tooltip__item"),document.createElement("a"));r.classList.add("share-tooltip__link","share-tooltip__link_".concat(t.name)),r.href=t.link,r.target="_blank",e.appendChild(r),n.appendChild(e)}),n}},{key:"show",value:function(){this.node.classList.add("visible")}},{key:"hide",value:function(){this.node.classList.remove("visible")}},{key:"remove",value:function(){for(;this.node.firstChild;)this.node.removeChild(this.node.firstChild);this.hide()}},{key:"onDocument",value:function(){var e=this;document.addEventListener("click",function(t){e.parent.contains(t.target)||e.remove()})}},{key:"onWindow",value:function(){var t=this;window.addEventListener("scroll",function(){return t.remove()})}}])}();function initShares(){var t=document.querySelector(".share-tooltip");t&&new ShareLinks(t).init()}window.addEventListener("load",initShares);var showSpinner=function(){var t=document.getElementById("spinner");t.classList.add("display"),setTimeout(function(){return t.classList.add("visible")},100)},hideSpinner=function(){var t=document.getElementById("spinner");t.classList.remove("visible"),setTimeout(function(){return t.classList.remove("display")},1e3)},initHeaderScripts=(window.addEventListener("load",function(){document.getElementById("spinner")&&(window.spinner.show=showSpinner,window.spinner.hide=hideSpinner)}),function(){var t=document.querySelector(".header-info__menu--burger"),e=document.querySelector(".nav-mobile"),r=document.querySelector(".nav-mobile__header_close"),n=document.querySelector(".nav-mobile__open-icon");t&&e&&r&&n&&(t.addEventListener("click",function(){e.classList.add("visible"),n.classList.remove("nav-mobile__open-icon_active"),document.querySelector(".nav-mobile__list_drop").classList.remove("nav-mobile__list_drop-open"),document.querySelectorAll(".drop-submenu__list").forEach(function(t){t.classList.remove("drop-submenu__list_open")}),document.querySelectorAll(".drop-submenu__item").forEach(function(t){t.classList.remove("drop-submenu__item_open")})}),r.addEventListener("click",function(){e.classList.remove("visible")}),e.addEventListener("click",function(t){(t.target.classList.contains("nav-mobile__link_drop")||t.target.classList.contains("nav-mobile__open-icon"))&&(t.preventDefault(),t.target.closest(".nav-mobile__list").querySelector(".nav-mobile__list_drop").classList.toggle("nav-mobile__list_drop-open"),n.classList.toggle("nav-mobile__open-icon_active")),(t.target.classList.contains("drop-submenu__title")||t.target.classList.contains("drop-submenu__plus"))&&(t.target.closest(".drop-submenu__item").querySelector(".drop-submenu__list").classList.toggle("drop-submenu__list_open"),t.target.closest(".drop-submenu__item").classList.toggle("drop-submenu__item_open"))}))}),initHeaderTooltips=function(){var t=document.querySelectorAll(".header-info__btn:has(.header-info__tooltip a)");t.length&&t.forEach(function(e){return e.addEventListener("click",function(){var t=e.querySelector(".header-info__tooltip");t&&toggleHeaderTooltipVisible(t)})})},initHeaderTooltipHide=function(){window.addEventListener("scroll",hideAllHeaderTooltips),document.addEventListener("click",function(t){var e,t=t.target;t.closest(".header-info__btn")?(e=t.querySelector(".header-info__tooltip"),hideAllHeaderTooltips(),setTimeout(function(){return toggleHeaderTooltipVisible(e)},10)):hideAllHeaderTooltips()})};function toggleHeaderTooltipVisible(t){t&&t.classList.toggle("visible")}function hideAllHeaderTooltips(t){var e=document.querySelectorAll(".header-info__tooltip");e&&e.forEach(function(t){return t.classList.remove("visible")})}window.addEventListener("load",function(){initHeaderScripts(),initHeaderTooltips(),initHeaderTooltipHide()});var ADD_PRODUCT_TO_ORDER_FROM="card",initProductCounters=function(){function c(t,e){t&&(e="string"==typeof e?""===e?1:parseInt(e):e,t.dataset.productCount=e)}var t=document.querySelectorAll(".card-top__quantity_changer");t.forEach(function(t){var e=t.parentNode.querySelector(".card-product__bottom-buy"),r=t.querySelector(".changer__input"),n=t.querySelector(".changer__btn_minus"),o=t.querySelector(".changer__btn_plus");var a=Number(r.value);r.addEventListener("keyup",function(t){"0"==t.currentTarget.value&&(t.currentTarget.value=1),a=Number(r.value),gettingTheFullCost(),"Enter"===t.key&&t.currentTarget.blur()}),r.addEventListener("keypress",function(t){var e;31<(e=(t=t).which||t.keyCode)&&(e<48||57<e)&&t.preventDefault(),gettingTheFullCost()}),r.addEventListener("change",function(t){(!t.currentTarget.value||t.currentTarget.value<1)&&(t.currentTarget.value=1),a=Number(r.value),gettingTheFullCost()}),r.addEventListener("input",function(t){(t.currentTarget.value<=1?(n.classList.add("changer__btn_disabled"),o):n).classList.remove("changer__btn_disabled"),9998<t.currentTarget.value?(n.classList.remove("changer__btn_disabled"),o.classList.add("changer__btn_disabled")):o.classList.remove("changer__btn_disabled"),gettingTheFullCost(),c(e,r.value)}),r.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation()}),n.addEventListener("click",function(t){t.preventDefault(),a--,r.value=a,r.value||(r.value=1,n.classList.add("changer__btn_disabled"),o.classList.remove("changer__btn_disabled")),(r.value<=1?(r.value=1,n.classList.add("changer__btn_disabled"),o):n).classList.remove("changer__btn_disabled"),gettingTheFullCost(),c(e,a)}),o.addEventListener("click",function(t){t.preventDefault(),a++,n.classList.remove("changer__btn_disabled"),r.value=a,9998<r.value?(r.value=9999,o.classList.add("changer__btn_disabled")):o.classList.remove("changer__btn_disabled"),gettingTheFullCost(),c(e,a)})})};function initCustomSelects(t){t=document.querySelectorAll(t);t.length&&t.forEach(function(o){o.dataset.init||(o.dataset.init="true",o.addEventListener("click",function(t){return e=o,(t=t).stopPropagation(),void("INPUT"!==t.target.tagName?e.classList.toggle("custom-select--open"):(r=t.target.closest(".custom-select__option"))&&((n=e.querySelector(".custom-select__value")).textContent=r.dataset.orderId?"№ ".concat("null"!==r.dataset.number1c?r.dataset.number1c:r.dataset.article," от ").concat(r.dataset.created):"Новый заказ",Object.entries({orderId:"data-order-id",article:"data-article",number1c:"data-number1c",created:"data-created",status:"data-status",statusText:"data-status-text"}).forEach(function(t){var t=_slicedToArray(t,2),e=t[0],t=t[1];r.dataset[e]?n.dataset[e]=r.dataset[e]:n.removeAttribute(t)}),n.dataset.selected="true",t=e.closest(".card-top__order-wrap"))&&(e=t.querySelector(".card-top__order-status mark"))&&(e.textContent=r.dataset.orderId?r.dataset.statusText:""));var e,r,n}))})}function getListOrders(){return _getListOrders.apply(this,arguments)}function _getListOrders(){return(_getListOrders=_asyncToGenerator(_regeneratorRuntime().mark(function t(){var e;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetchListOrdersData();case 3:updateListOrders(".card",e=t.sent,"product-card-order"),updateListOrders(".modal",e,"modal-card-order"),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.debug("Ошибка при получении заказов залогиненого пользователя:",t.t0);case 11:case"end":return t.stop()}},t,null,[[0,8]])}))).apply(this,arguments)}function fetchListOrdersData(){return _fetchListOrdersData.apply(this,arguments)}function _fetchListOrdersData(){return(_fetchListOrdersData=_asyncToGenerator(_regeneratorRuntime().mark(function t(){var e,r;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=window.listOrders){t.next=4;break}return console.debug("Не корректный URL для списка заказов!"),t.abrupt("return");case 4:return t.next=6,fetch(e,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});case 6:if((r=t.sent).ok){t.next=9;break}throw new Error("Ошибка сети при получении данных с ".concat(e));case 9:return t.next=11,r.json();case 11:return t.abrupt("return",t.sent.data);case 13:case"end":return t.stop()}},t)}))).apply(this,arguments)}function updateListOrders(t,e,r){var n=document.querySelector("".concat(t," .custom-select__list")),t=document.querySelector("".concat(t," .custom-select__value"));n&&t&&e&&appendListOrders(n,t,e,r)}function appendListOrders(n,o,t,a){var e=t.find(function(t){return t.default}),c=!o.dataset.selected;n.innerHTML="",n.insertAdjacentHTML("beforeend",'\n\t\t<li class="custom-select__item custom-select__item--sort">\n\t\t\t<label class="custom-select__option"\n\t\t\t\t\tdata-status="NEW_ORDER"\n\t\t\t\t\tdata-status-text="Новый заказ">\n\t\t\t\t<input class="invisible" type="radio" name="'.concat(a,'" ').concat(!e&&c||"NEW_ORDER"===o.dataset.status?"checked":"",">\n\t\t\t\t<span>Новый заказ</span>\n\t\t\t</label>\n\t\t</li>")),t.forEach(function(t){var e=window.formatDate(t.meta.created_at),r=!(!t.default||!c)||o.dataset.article===t.number;n.insertAdjacentHTML("beforeend",'\n\t\t\t<li class="custom-select__item custom-select__item--sort">\n\t\t\t\t<label class="custom-select__option"\n\t\t\t\t\t\tdata-order-id="'.concat(t.id,'"\n\t\t\t\t\t\tdata-article="').concat(t.number,'"\n\t\t\t\t\t\tdata-number1c="').concat(t.number_1c,'"\n\t\t\t\t\t\tdata-created="').concat(e,'"\n\t\t\t\t\t\tdata-status="').concat(t.status.current.name,'"\n\t\t\t\t\t\tdata-status-text="').concat(t.status.current.label,'">\n\t\t\t\t\t<input class="invisible" type="radio" name="').concat(a,'" ').concat(r?"checked":"",">\n                    <span>").concat(["Заказ №",t.number_1c,t.number].filter(Boolean).join(" "),"</span>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<i>от ").concat(e,"</i>\n\t\t\t\t\t\t<mark>").concat(t.status.current.label,"</mark>\n\t\t\t\t\t</div>\n\t\t\t\t</label>\n\t\t\t</li>")),t.default&&c&&(o.textContent="№ ".concat(t.number_1c||t.number," от ").concat(e),o.dataset.orderId="".concat(t.id),o.dataset.article="".concat(t.number),o.dataset.number1c="".concat(t.number_1c),o.dataset.created="".concat(e),o.dataset.status="".concat(t.status.current.name),o.dataset.statusText="".concat(t.status.current.label))})}function checkAddProductButton(t){switch((t?t.closest(".card-top__order"):document.querySelector(".card-top__order")).querySelector(".custom-select__value").dataset.status){case"NEW_ORDER":showOrderWar("#orderAddProductNewOrder");break;case"RESERVED":showOrderWar("#orderAddProductWar");break;default:addProductToOrder()}}function addProductToOrder(){return _addProductToOrder.apply(this,arguments)}function _addProductToOrder(){return(_addProductToOrder=_asyncToGenerator(_regeneratorRuntime().mark(function t(){var e,r,n,o,a,c,i,s,d,l,u,m,p,h,f;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n="card"===ADD_PRODUCT_TO_ORDER_FROM?document.querySelector(".card"):document.getElementById("fastView"),e=n.querySelector(".card-top__quantity .changer__input"),e=e.value,o=n.querySelector(".card-top__btn_order"),n=n.querySelector(".card-top__order"),r=n.querySelector(".custom-select__value"),n=r.dataset.orderId,o=o.dataset.productId,a="NEW_ORDER"===r.dataset.status,c=window.addProductApiLink,i=new FormData,n&&"undefined"!==n&&i.append("order",n),i.append("product",o),i.append("count",e),t.prev=14,c){t.next=17;break}throw new Error("Не корректный api url для добавления товара!");case 17:window.spinner.show(),s={},d=_createForOfIteratorHelper(i.entries());try{for(d.s();!(l=d.n()).done;)u=l.value,s[u[0]]=u[1]}catch(t){d.e(t)}finally{d.f()}return console.log("Add product Request:",s),t.next=24,fetch(c,{method:"POST",body:i,credentials:"include"});case 24:if((m=t.sent).ok){t.next=27;break}throw new Error("Ошибка добавления товара!");case 27:return t.next=29,m.json();case 29:h=(p=t.sent).data.number||p.data.number_1c||p.data.id,f=window.formatDate(p.data.meta.created_at),setTimeout(function(){var t;window.spinner.hide(),showOrderWar("#orderApproved","".concat(h," от ").concat(f),p.data),document.querySelector(".card-top__quantity .changer__input").value=1,a&&(t=document.querySelector(".card")||document.querySelector(".modal"))&&(updateSelectedOrderValue(p.data,r),addNewOptionToOrderSelector(p.data,t)),getListOrders()},1e3),"function"==typeof initOrders&&initOrders(!0),t.next=40;break;case 36:t.prev=36,t.t0=t.catch(14),console.error(t.t0),setTimeout(function(){window.spinner.hide(),showOrderWar("#orderError")},1e3);case 40:case"end":return t.stop()}},t,null,[[14,36]])}))).apply(this,arguments)}function updateSelectedOrderValue(t,e){var r=window.formatDate(t.meta.created_at);e.textContent="№ ".concat(t.number_1c||t.id," от ").concat(r),e.dataset.orderId="".concat(t.id),e.dataset.article="".concat(t.number),e.dataset.number1c="".concat(t.number_1c),e.dataset.created="".concat(r),e.dataset.status="".concat(t.status.current.name),e.dataset.statusText="".concat(t.status.current.label)}function addNewOptionToOrderSelector(t,e){var r,n,e=e.querySelector(".custom-select__list");e&&(e=e.querySelector('.custom-select__item:has([data-status="NEW_ORDER"])'))&&(r=window.formatDate(t.meta.created_at),n=e.querySelector("input").getAttribute("name"),n='\n\t\t<li class="custom-select__item custom-select__item--sort">\n\t\t\t<label class="custom-select__option"\n\t\t\t\t\tdata-order-id="'.concat(t.id,'"\n\t\t\t\t\tdata-article="').concat(t.number,'"\n\t\t\t\t\tdata-number1c="').concat(t.number_1c,'"\n\t\t\t\t\tdata-created="').concat(r,'"\n\t\t\t\t\tdata-status="').concat(t.status.current.name,'"\n\t\t\t\t\tdata-status-text="').concat(t.status.current.label,'">\n\t\t\t\t<input class="invisible" type="radio" name="').concat(n,'" checked>\n\t\t\t\t<span>',"Заказ № ".concat(t.number_1c||t.id," ").concat(t.number),"</span>\n\t\t\t\t<div>\n\t\t\t\t\t<i>от ").concat(r,"</i>\n\t\t\t\t\t<mark>").concat(t.status.current.label,"</mark>\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t</li>\n\t"),e.insertAdjacentHTML("afterend",n))}window.addEventListener("load",function(){initProductCounters(),initCustomSelects(".custom-select, #fastView .custom-select"),getListOrders()});