function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function _regeneratorRuntime(){_regeneratorRuntime=function(){return o};var a,o={},e=Object.prototype,c=e.hasOwnProperty,u=Object.defineProperty||function(e,t,n){e[t]=n.value},t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",n=t.asyncIterator||"@@asyncIterator",i=t.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(a){l=function(e,t,n){return e[t]=n}}function s(e,t,n,r){var i,l,o,s,t=t&&t.prototype instanceof v?t:v,t=Object.create(t.prototype),r=new L(r||[]);return u(t,"_invoke",{value:(i=e,l=n,o=r,s=h,function(e,t){if(s===f)throw Error("Generator is already running");if(s===p){if("throw"===e)throw t;return{value:a,done:!0}}for(o.method=e,o.arg=t;;){var n=o.delegate;if(n){n=function e(t,n){var r=n.method,i=t.iterator[r];if(i===a)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=a,e(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;r=d(i,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,y;i=r.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=a),n.delegate=null,y):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}(n,o);if(n){if(n===y)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(s===h)throw s=p,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s=f;n=d(i,l,o);if("normal"===n.type){if(s=o.done?p:m,n.arg===y)continue;return{value:n.arg,done:o.done}}"throw"===n.type&&(s=p,o.method="throw",o.arg=n.arg)}})}),t}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}o.wrap=s;var h="suspendedStart",m="suspendedYield",f="executing",p="completed",y={};function v(){}function g(){}function w(){}var t={},b=(l(t,r,function(){return this}),Object.getPrototypeOf),b=b&&b(b(E([]))),k=(b&&b!==e&&c.call(b,r)&&(t=b),w.prototype=v.prototype=Object.create(t));function S(e){["next","throw","return"].forEach(function(t){l(e,t,function(e){return this._invoke(t,e)})})}function _(o,s){var t;u(this,"_invoke",{value:function(n,r){function e(){return new s(function(e,t){!function t(e,n,r,i){var l,e=d(o[e],o,n);if("throw"!==e.type)return(n=(l=e.arg).value)&&"object"==_typeof(n)&&c.call(n,"__await")?s.resolve(n.__await).then(function(e){t("next",e,r,i)},function(e){t("throw",e,r,i)}):s.resolve(n).then(function(e){l.value=e,r(l)},function(e){return t("throw",e,r,i)});i(e.arg)}(n,r,e,t)})}return t=t?t.then(e,e):e()}})}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function F(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function E(t){if(t||""===t){var n,e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return n=-1,(e=function e(){for(;++n<t.length;)if(c.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=a,e.done=!0,e}).next=e}throw new TypeError(_typeof(t)+" is not iterable")}return u(k,"constructor",{value:g.prototype=w,configurable:!0}),u(w,"constructor",{value:g,configurable:!0}),g.displayName=l(w,i,"GeneratorFunction"),o.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,l(e,i,"GeneratorFunction")),e.prototype=Object.create(k),e},o.awrap=function(e){return{__await:e}},S(_.prototype),l(_.prototype,n,function(){return this}),o.AsyncIterator=_,o.async=function(e,t,n,r,i){void 0===i&&(i=Promise);var l=new _(s(e,t,n,r),i);return o.isGeneratorFunction(t)?l:l.next().then(function(e){return e.done?e.value:l.next()})},S(k),l(k,i,"Generator"),l(k,r,function(){return this}),l(k,"toString",function(){return"[object Generator]"}),o.keys=function(e){var t,n=Object(e),r=[];for(t in n)r.push(t);return r.reverse(),function e(){for(;r.length;){var t=r.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},o.values=E,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=a,this.done=!1,this.delegate=null,this.method="next",this.arg=a,this.tryEntries.forEach(F),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=a)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function e(e,t){return l.type="throw",l.arg=n,r.next=e,t&&(r.method="next",r.arg=a),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],l=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var o=c.call(i,"catchLoc"),s=c.call(i,"finallyLoc");if(o&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&c.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}var l=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return l.type=e,l.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(l)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),F(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n,r,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(n=i.completion).type&&(r=n.arg,F(i)),r}throw Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=a),y}},o}function asyncGeneratorStep(e,t,n,r,i,l,o){try{var s=e[l](o),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,i)}function _asyncToGenerator(s){return function(){var e=this,o=arguments;return new Promise(function(t,n){var r=s.apply(e,o);function i(e){asyncGeneratorStep(r,t,n,i,l,"next",e)}function l(e){asyncGeneratorStep(r,t,n,i,l,"throw",e)}i(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var FileDownloader=function(){function e(){var s=this;if(_classCallCheck(this,e),_defineProperty(this,"debouncedSearch",window.debounce(function(){var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n,r,i,l,o;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(""===(n=t.value.trim()))return s.resetSearching(),e.abrupt("return");e.next=4;break;case 4:if(!(3<=n.length)){e.next=35;break}if(e.prev=5,r=window.filesSearchUrl){e.next=9;break}throw new Error("URL для поиска по артикулу не настроен (window.filesSearchUrl)");case 9:return o=n,(i=null==(i=s.selectedFilters.find(function(e){return"brand"===e.type}))?void 0:i.values)&&(o+=i.map(function(e){return'"'.concat(e,'"')}).join("")),(i=null==(i=s.selectedFilters.find(function(e){return"collection"===e.type}))?void 0:i.values)&&(o+=i.map(function(e){return'"'.concat(e,'"')}).join("")),s.elements.articleSearchProcessing.classList.add("visible"),s.elements.articleSearchFail.classList.remove("visible"),s.elements.articleSearchResults.classList.remove("visible"),i="".concat(r).concat(o),e.next=20,fetch(i);case 20:if((l=e.sent).ok){e.next=23;break}throw new Error("Ошибка запроса поиска по артикулу!");case 23:return e.next=25,l.json();case 25:o=e.sent,s.updateSearchResult(n,o),e.next=32;break;case 29:e.prev=29,e.t0=e.catch(5),console.error("Ошибка запроса по артикулу",e.t0);case 32:return e.prev=32,s.elements.articleSearchProcessing.classList.remove("visible"),e.finish(32);case 35:case"end":return e.stop()}},e,null,[[5,29,32,35]])}));return function(e){return t.apply(this,arguments)}}(),700)),_instance._)throw new Error("Use FileDownloader.getInstance() instead of new FileDownloader()");this.elements={},this.data=null,this.filteredData=null,this.types=null,this.selectedFilters=[],this.responseArticleData=[],this.selectedArticlesData=[],_instance._=this}return _createClass(e,[{key:"init",value:(r=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n=this;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setHtmlElements(),window.spinner.show(),e.prev=2,e.next=5,this.getInitData();case 5:this.data=e.sent,this.types=this.buildTypesFromData(this.data),this.elements.app.classList.add("visible"),this.elements.app.classList.add("show"),console.log("Documents types",this.types),console.log(Array.from(new Set(this.data.map(function(e){return e.ext})))),e.next=19;break;case 13:return e.prev=13,e.t0=e.catch(2),console.error("Request files",e.t0),this.elements.error.classList.add("visible"),setTimeout(function(){n.elements.error.classList.add("show")},1300),e.abrupt("return");case 19:return e.prev=19,window.spinner.hide(),e.finish(19);case 22:this.data&&(t=Array.from(new Set(this.data.flatMap(function(e){return e.products}).map(function(e){return e.vendor}))).filter(Boolean).map(function(e){return{option:e,data:null}}),this.buildCustomSelector(this.elements.brandSelector,t,"brand"),t=Array.from(new Set(this.data.flatMap(function(e){return e.products}).map(function(e){var t=e.vendor;return JSON.stringify({vendor:t,collection:e.collection})}))).map(function(e){return JSON.parse(e)}).filter(function(e){return e.vendor&&e.collection}).map(function(e){var t=e.vendor;return{option:e.collection,data:{vendor:t}}}),this.buildCustomSelector(this.elements.collectionSelector,t,"collection")),this.setResetActiveSelectors(),this.setChipsList(),this.setToggleFileTypes(),this.setDownloadFiles(),this.setResettingAllControllers(),this.setResetAllFilters(),this.setShowFilesButton(),this.setDownloadFileButton(),this.setSearch(),this.setFilteringCollectionOptions();case 33:case"end":return e.stop()}},e,this,[[2,13,19,22]])})),function(){return r.apply(this,arguments)})},{key:"buildTypesFromData",value:function(e){var n;return e&&Array.isArray(e)&&0!==e.length?(n={},e.forEach(function(e){var t=e.dir_name;t&&!n[t]&&(n[t]={name:t,title:e.dir_title,selected:!1})}),n):{}}},{key:"getInitData",value:(n=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=window.filesApiUrl){e.next=3;break}throw new Error("Ссылка на Api файлов для скачивания window.filesApiUrl не корректная или отсутствует на странице.");case 3:return e.next=5,fetch(t);case 5:if((n=e.sent).ok){e.next=8;break}throw new Error("HTTP error! Status: ".concat(n.status));case 8:return e.next=10,n.json();case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)})},{key:"setHtmlElements",value:function(){this.elements.app=document.getElementById("downFilesApp"),this.elements.error=document.getElementById("marketingErr"),this.elements.brandSelector=document.getElementById("brandSelector"),this.elements.collectionSelector=document.getElementById("collectionSelector"),this.elements.articleSearch=document.getElementById("articleSearch"),this.elements.articleSearchProcessing=document.getElementById("articleSearchProcessing"),this.elements.articleSearchFail=document.getElementById("articleSearchFail"),this.elements.articleSearchResults=document.getElementById("articleSearchResults"),this.elements.resetFiltersButton=document.getElementById("resetFiltersButton"),this.elements.showFilesButton=document.getElementById("showFilesButton"),this.elements.filteredChips=document.getElementById("filteredChips"),this.elements.marketingCards=document.getElementById("marketingCards"),this.elements.marketingFiles=document.getElementById("marketingFiles"),this.elements.marketingDown=document.getElementById("marketingDown"),this.elements.marketingDownCounter=document.getElementById("marketingDownCounter"),this.elements.marketingDownResetButton=document.getElementById("marketingDownResetButton"),this.elements.marketingDownButton=document.getElementById("marketingDownButton"),this.elements.marketingDownSizeButton=document.getElementById("marketingDownSizeButton"),this.elements.marketingFilterSummary=document.getElementById("marketingFilterSummary")}},{key:"buildCustomSelector",value:function(r,e,i){var t,l,n,o=this;r&&Array.isArray(e)&&e.length&&(t=r.querySelector(".single-selector__trigger"),l=r.querySelector(".single-selector__dropdown"),n=null==t?void 0:t.querySelector("span"),t)&&l&&n&&(this.cleanElementChildren(l),_toConsumableArray(e).sort(function(e,t){return e.option.localeCompare(t.option)}).forEach(function(e){var t=e.option,e=e.data,n=document.createElement("button");n.type="button",n.className="single-selector__option",n.dataset.value=t,n.textContent=t,"collection"===i&&(n.title=e.vendor,n.dataset.vendor=e.vendor),n.addEventListener("click",function(){var e=n.classList.toggle("selected");e?o.addChip(t,i):o.removeChip(t,i),o.updateSelectorText(r,i),o.updateFilterSummaryVisibility(),o.updateContentVisibility(),o.filterData(),o.pusOptionToSelectedFilters(t,i,e),o.filterOptions()}),l.appendChild(n)}),t.addEventListener("click",function(){r.classList.toggle("active")}),n.textContent="Выберите значение",n.classList.remove("selected"))}},{key:"pusOptionToSelectedFilters",value:function(t,n,e){var r=this.selectedFilters.find(function(e){return e.type===n});r?(e?r.values.push(t):r.values=r.values.filter(function(e){return e!==t}),r.values=Array.from(new Set(r.values))):this.selectedFilters.push({type:n,values:[t]}),this.selectedFilters=this.selectedFilters.filter(function(e){return e.values.length})}},{key:"filterOptions",value:function(){var e,t;this.selectedFilters.length?(e=this.selectedFilters.find(function(e){return"brand"===e.type}),t=this.selectedFilters.find(function(e){return"collection"===e.type}),e&&!t?(this.filterCollectionsByBrands(e.values),this.showAllBrands()):t&&!e?(this.filterBrandsByCollections(t.values),this.showAllCollections()):e&&t&&(this.filterCollectionsByBrands(e.values),this.filterBrandsByCollections(t.values))):this.showAllOptions()}},{key:"filterCollectionsByBrands",value:function(n){this.elements.collectionSelector&&this.elements.collectionSelector.querySelectorAll(".single-selector__option").forEach(function(e){var t=e.dataset.vendor;n.includes(t)?e.classList.remove("hidden"):e.classList.add("hidden")})}},{key:"filterBrandsByCollections",value:function(n){var r;this.elements.brandSelector&&(r=new Set,this.elements.collectionSelector.querySelectorAll(".single-selector__option").forEach(function(e){var t=e.dataset.value,e=e.dataset.vendor;n.includes(t)&&r.add(e)}),this.elements.brandSelector.querySelectorAll(".single-selector__option").forEach(function(e){var t=e.dataset.value;r.has(t)?e.classList.remove("hidden"):e.classList.add("hidden")}))}},{key:"showAllBrands",value:function(){this.elements.brandSelector&&this.elements.brandSelector.querySelectorAll(".single-selector__option").forEach(function(e){e.classList.remove("hidden")})}},{key:"showAllCollections",value:function(){this.elements.collectionSelector&&this.elements.collectionSelector.querySelectorAll(".single-selector__option").forEach(function(e){e.classList.remove("hidden")})}},{key:"showAllOptions",value:function(){this.showAllBrands(),this.showAllCollections()}},{key:"addChip",value:function(e,t){var n;this.elements.filteredChips&&(this.elements.filteredChips.querySelector("[data-type='".concat(t,"'][data-value='").concat(e,"']"))?console.warn('Чим с типом "'.concat(t,'" и значением "').concat(e,'" уже существует')):((n=document.createElement("li")).dataset.value=e,n.dataset.type=t,(t=document.createElement("span")).innerText=e,n.appendChild(t),e=document.createElement("i"),n.appendChild(e),this.elements.filteredChips.appendChild(n)))}},{key:"removeChip",value:function(e,t){this.elements.filteredChips&&(t=this.elements.filteredChips.querySelector("[data-type='".concat(t,"'][data-value='").concat(e,"']")))&&(t.remove(),this.updateFilterSummaryVisibility(),this.updateContentVisibility(),this.filterData())}},{key:"updateSelectorText",value:function(e,t){e=e.querySelector(".single-selector__trigger span");e&&(0===(t=Array.from(this.elements.filteredChips.querySelectorAll("[data-type='".concat(t,"']")))).length?(e.classList.remove("selected"),e.innerText="Выберите значение"):(t=t.map(function(e){return e.dataset.value}),e.classList.add("selected"),e.innerText=t.join(", ")))}},{key:"getSelectedValues",value:function(e){return this.elements.filteredChips?Array.from(this.elements.filteredChips.querySelectorAll("[data-type='".concat(e,"']"))).map(function(e){return e.dataset.value}):[]}},{key:"setChipsList",value:function(){var l=this;this.cleanElementChildren(this.elements.filteredChips),this.elements.filteredChips.addEventListener("click",function(e){if("I"===e.target.tagName){var e=e.target.parentElement,t=e.dataset.type,n=e.dataset.value,r={brand:l.elements.brandSelector,collection:l.elements.collectionSelector}[t];if("article"===t)l.selectedArticlesData.find(function(e){return e.article===n})&&(l.selectedArticlesData=l.selectedArticlesData.filter(function(e){return e.article!==n}),console.log("this.selectedArticlesData",l.selectedArticlesData));else{if(!r)return void console.warn('Селектор для типа "'.concat(t,'" не найден!'));var i=r.querySelector('[data-value="'.concat(n,'"]')),i=(i&&i.classList.remove("selected"),l.selectedFilters.find(function(e){return e.type===t}));if(!i)return;i.values=i.values.filter(function(e){return e!==n}),l.selectedFilters=l.selectedFilters.filter(function(e){return e.values.length})}e.remove(),"article"!==t&&l.updateSelectorText(r,t),l.filterOptions(),l.updateFilterSummaryVisibility(),l.updateContentVisibility(),l.filterData()}})}},{key:"cleanElementChildren",value:function(e){if(!(e&&e instanceof HTMLElement))return console.warn("Invalid element provided to cleanElementChildren"),null;for(;e.firstChild;)e.removeChild(e.firstChild)}},{key:"setResetAllFilters",value:function(){var t=this;this.elements.resetFiltersButton&&this.elements.resetFiltersButton.addEventListener("click",function(){var e;[{element:t.elements.brandSelector,type:"brand"},{element:t.elements.collectionSelector,type:"collection"}].forEach(function(e){var t,e=e.element;e&&(e.querySelectorAll(".single-selector__option.selected").forEach(function(e){e.classList.remove("selected")}),(t=e.querySelector(".single-selector__trigger span"))&&(t.classList.remove("selected"),t.innerText="Выберите значение"),e.classList.remove("active"))}),t.cleanElementChildren(t.elements.filteredChips),t.updateFilterSummaryVisibility(),t.updateContentVisibility(),t.filterData(),t.selectedFilters=[],t.selectedArticlesData=[],t.showAllOptions(),t.data&&0<t.data.length&&(e=t.groupDocumentsByType(t.data),t.updateFileTypeCardsAvailability(e)),t.resetContent(),t.resetFilteringCollection()})}},{key:"setShowFilesButton",value:function(){var t=this;this.elements.showFilesButton&&this.elements.showFilesButton.addEventListener("click",function(){var e;null!=(e=t.filteredData)&&e.length||t.selectedArticlesData.length?(t.elements.marketingCards.classList.add("visible"),e=t.selectedArticlesData.flatMap(function(e){return e.documents||[]}),e=[].concat(_toConsumableArray(t.filteredData||[]),_toConsumableArray(e)),e=Array.from(new Map(e.map(function(e){return[e.id,e]})).values()),e=t.groupDocumentsByType(e),t.updateFileTypeCardsAvailability(e),t.renderFileSections(e),t.elements.marketingFiles.classList.add("visible"),t.scrollToFiles()):console.warn("Нет отфильтрованных файлов для отображения")})}},{key:"updateFileTypeCardsAvailability",value:function(e){var n;this.elements.marketingCards&&(n=Object.keys(e),Array.from(this.elements.marketingCards.querySelectorAll(".marketing__card-item")).forEach(function(e){var t=e.querySelector("i");t&&(t=t.dataset.type)&&(n.includes(t)?e.classList.remove("disabled"):e.classList.add("disabled"))}))}},{key:"resetContent",value:function(){this.elements.marketingCards.classList.remove("visible"),Array.from(this.elements.marketingFiles.querySelectorAll(".marketing__files-section")).forEach(function(e){e.classList.remove("visible")}),this.elements.marketingDown.classList.remove("visible")}},{key:"groupDocumentsByType",value:function(e){var n={};return e.forEach(function(e){var t=e.dir_name;n[t]||(n[t]=[]),n[t].push(e)}),n}},{key:"renderFileSections",value:function(r){var i=this;console.log("documentsByType",r),this.elements.marketingFiles.querySelectorAll(".marketing__files-section").forEach(function(e){e.classList.remove("visible")}),Object.keys(r).forEach(function(e){var t,n=r[e];0!==n.length&&((t=i.elements.marketingFiles.querySelector('[data-type="'.concat(e,'"]')))?(t.classList.add("visible"),i.fillSectionWithFiles(t,n,e)):console.warn('На странице нет секции с типом "'.concat(e,'"')))})}},{key:"fillSectionWithFiles",value:function(e,t,n){var r=this,i=e.querySelector(".marketing__file-list");this.cleanElementChildren(i),t.forEach(function(e){e=r.createFileItem(e,n);i.appendChild(e)})}},{key:"createFileItem",value:function(e,t){var n=document.createElement("div"),r=(n.className="marketing__file-item",document.createElement("div")),i=(r.className="marketing__file-actions",document.createElement("a")),i=(i.href=e.download_link,i.download=e.title,i.target="_blank",r.appendChild(i),document.createElement("label")),l=document.createElement("input"),l=(l.className="invisible",l.type="checkbox",l.name=e.name,l.dataset.type="controller",l.dataset.documentId=e.id,l.dataset.size=e.size,l.dataset.path=e.path,i.appendChild(l),r.appendChild(i),n.appendChild(r),document.createElement("div")),i=(l.className="marketing__file-preview",l.textContent=e.title,document.createElement("span"));return i.textContent=e.ext,l.prepend(i),n.appendChild(l),n}},{key:"scrollToFiles",value:function(){this.elements.marketingCards&&this.elements.marketingCards.scrollIntoView({behavior:"smooth",block:"start"})}},{key:"updateFilterSummaryVisibility",value:function(){this.elements.marketingFilterSummary&&(this.elements.filteredChips&&0<this.elements.filteredChips.children.length?this.elements.marketingFilterSummary.classList.add("visible"):this.elements.marketingFilterSummary.classList.remove("visible"))}},{key:"updateContentVisibility",value:function(){!this.elements.filteredChips||0<this.elements.filteredChips.children.length||(this.elements.marketingCards&&this.elements.marketingCards.classList.remove("visible"),this.elements.marketingFiles&&(this.elements.marketingFiles.classList.remove("visible"),this.elements.marketingFiles.querySelectorAll(".marketing__files-section").forEach(function(e){e.classList.remove("visible")})))}},{key:"filterData",value:function(){var n,r,e,t;this.data?(n=this.getSelectedValues("brand"),r=this.getSelectedValues("collection"),e=this.selectedArticlesData.reduce(function(e,t){return null!=t&&t.documents&&Array.isArray(t.documents)?e+t.documents.length:e},t=0),0===n.length&&0===r.length?(this.filteredData=null,this.updateShowFilesButton(0+e)):(this.filteredData=this.data.filter(function(e){return!(!e.products||0===e.products.length)&&e.products.some(function(e){var t=0===n.length||n.includes(e.vendor),e=0===r.length||r.includes(e.collection);return t&&e})}),t=this.filteredData.length,this.updateShowFilesButton(t+e),this.filteredData&&0<this.filteredData.length&&(t=this.groupDocumentsByType(this.filteredData),this.updateFileTypeCardsAvailability(t)))):(this.filteredData=null,this.updateShowFilesButton(0))}},{key:"updateShowFilesButton",value:function(e){var t;this.elements.showFilesButton&&(t=this.elements.showFilesButton.querySelector("span"))&&(t.textContent="Показать файлы (".concat(e,")"))}},{key:"setResetActiveSelectors",value:function(){var t=this;document.addEventListener("click",function(e){e=e.target;e.closest("#".concat(t.elements.brandSelector.id))||t.elements.brandSelector.classList.remove("active"),e.closest("#".concat(t.elements.collectionSelector.id))||t.elements.collectionSelector.classList.remove("active")})}},{key:"setToggleFileTypes",value:function(){var r=this;this.elements.marketingCards&&this.elements.marketingFiles&&Array.from(this.elements.marketingCards.querySelectorAll("input")).forEach(function(n){n.addEventListener("change",function(){var e=n.checked,t=n.name;t in r.types&&(r.types[t].selected=e),r.checkFileSectionsVisible()})})}},{key:"checkFileSectionsVisible",value:function(){if(Object.values(this.types).find(function(e){return e.selected}))for(var e in this.types){var t=this.elements.marketingFiles.querySelector('[data-type="'.concat(e,'"]'));t&&(this.types[e].selected?t.classList.add("visible"):(t.classList.remove("visible"),(t=this.elements.marketingFiles.querySelector('[data-type="'.concat(e,'"]')))&&this.resetHiddenControllers(t)))}else for(var n in this.types){var n=this.elements.marketingFiles.querySelector('[data-type="'.concat(n,'"]')),r=0<n.querySelectorAll(".marketing__file-item").length;n&&r&&n.classList.add("visible")}}},{key:"setDownloadFiles",value:function(){var t=this;this.elements.marketingFiles.addEventListener("change",function(e){"controller"===e.target.dataset.type&&t.checkFilesToDown()})}},{key:"checkFilesToDown",value:function(){var e;this.elements.marketingFiles&&((e=Array.from(this.elements.marketingFiles.querySelectorAll("[data-type=controller]:checked"))).length?(this.elements.marketingDownCounter.innerText="".concat(e.length," "),e=e.reduce(function(e,t){return e+(parseInt(t.dataset.size,10)||0)},0),e=this.formatFileSize(e),this.elements.marketingDownSizeButton&&(this.elements.marketingDownSizeButton.textContent="(".concat(e,")")),this.elements.marketingDown.classList.add("visible")):this.elements.marketingDown.classList.remove("visible"))}},{key:"formatFileSize",value:function(e){var t;return 0===e?"0 Б":(t=Math.floor(Math.log(e)/Math.log(1024)),e=(e/Math.pow(1024,t)).toFixed(1).replace(".",","),"".concat(e," ").concat(["Б","КБ","МБ","ГБ","ТБ"][t]))}},{key:"resetHiddenControllers",value:function(e){e=(e||this.elements.marketingFiles).querySelectorAll("[data-type=controller]");e&&(Array.from(e).forEach(function(e){e.checked=!1}),this.checkFilesToDown())}},{key:"setResettingAllControllers",value:function(){var e=this;this.elements.marketingDownResetButton&&this.elements.marketingDownResetButton.addEventListener("click",function(){e.resetHiddenControllers()})}},{key:"setDownloadFileButton",value:function(){var l=this;this.elements.marketingDownButton&&this.elements.marketingDownButton.addEventListener("click",_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n,r,i;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t=Array.from(l.elements.marketingFiles.querySelectorAll("[data-type=controller]:checked"))).length){e.next=4;break}return console.warn("Не выбрано ни одного файла для скачивания"),e.abrupt("return");case 4:return window.spinner.show(),l.toggleTouchContent(!1),e.prev=6,n=t.map(function(e){return e.dataset.path}),e.next=10,l.getFilesArchive(n);case 10:r=(n=e.sent).filename,i=n.blob,l.downloadBlob(i,r),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(6),console.error("Ошибка при скачивании архива:",e.t0),alert("Не удалось скачать файлы: ".concat(e.t0.message));case 19:return e.prev=19,window.spinner.hide(),l.toggleTouchContent(!0),e.finish(19);case 23:case"end":return e.stop()}},e,null,[[6,15,19,23]])})))}},{key:"getFilesArchive",value:(t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n,r,i,l,o,s;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&0!==t.length){e.next=2;break}throw new Error("Список файлов пуст");case 2:if(n=window.filesDownUrl){e.next=5;break}throw new Error("URL для скачивания не настроен (window.filesDownUrl)");case 5:return e.next=7,fetch(n,{method:"POST",headers:{Accept:"application/zip","Content-Type":"application/json"},body:JSON.stringify({paths:t})});case 7:if((r=e.sent).ok){e.next=24;break}return i="HTTP ".concat(r.status),e.prev=10,e.next=13,r.json();case 13:i=(l=e.sent).error||l.message||i,e.next=23;break;case 17:return e.prev=17,e.t0=e.catch(10),e.next=21,r.text();case 21:(l=e.sent)&&(i=l);case 23:throw new Error(i);case 24:return e.next=26,r.blob();case 26:return o=e.sent,s=this.extractFilenameFromResponse(r)||this.generateArchiveName(),e.abrupt("return",{filename:s,blob:o});case 29:case"end":return e.stop()}},e,this,[[10,17]])})),function(e){return t.apply(this,arguments)})},{key:"extractFilenameFromResponse",value:function(e){var t,n,e=e.headers.get("Content-Disposition");return e?null!=(n=t=e.match(/filename="?([^"\n]+)"?/i))&&n[1]?(n=t[1].replace(/^"(.+)"$/,"$1"),decodeURIComponent(n)):null!=(n=t=e.match(/filename\*=UTF-8''([^\n]+)/i))&&n[1]?decodeURIComponent(t[1]):null:null}},{key:"generateArchiveName",value:function(){var e=(new Date).toISOString().split("T")[0],t=this.getSelectedValues("brand"),n=this.getSelectedValues("collection"),r=["files"];return 0<t.length&&r.push(t.join("-")),0<n.length&&r.push(n.join("-")),r.push(e),"".concat(r.join("_"),".zip")}},{key:"downloadBlob",value:function(e,t){var n=window.URL.createObjectURL(e),r=document.createElement("a");r.style.display="none",r.href=n,r.download=t,document.body.appendChild(r),r.click(),setTimeout(function(){window.URL.revokeObjectURL(n),document.body.removeChild(r)},100)}},{key:"toggleTouchContent",value:function(e){void 0===e?(this.elements.marketingDown.classList.toggle("blocked"),this.elements.app.classList.toggle("blocked")):e?(this.elements.marketingDown.classList.remove("blocked"),this.elements.app.classList.remove("blocked")):(this.elements.marketingDown.classList.add("blocked"),this.elements.app.classList.add("blocked"))}},{key:"setSearch",value:function(){var e,r=this;(this.elements.articleSearch||this.elements.articleSearchResults)&&(e=this.elements.articleSearch.querySelector("input"))&&(e.addEventListener("input",function(){return r.debouncedSearch(e)}),this.elements.articleSearch.addEventListener("click",function(e){var t,n,e=e.target.closest(".search-selector__option");e&&(t=e.dataset.article,e=r.responseArticleData.find(function(e){return e.article===t}),n=r.selectedArticlesData.find(function(e){return e.article===t}),e&&!n&&(r.selectedArticlesData.push(e),r.addChip(t,"article")),r.resetSearching(),r.updateFilterSummaryVisibility(),r.updateContentVisibility(),r.filterData())}),document.addEventListener("click",function(e){r.elements.articleSearch.contains(e.target)||r.resetSearching()}))}},{key:"updateSearchResult",value:function(t,e){var n,r=e.count,e=e.data;this.cleanElementChildren(this.elements.articleSearchResults),(r||e.length?(this.responseArticleData=e,n="",((r=e.filter(function(e){return e.is_absolute_match})).length?r:e).forEach(function(e){n+='\n\t\t\t\t<li class="search-selector__option'.concat(e.documents.length?"":" disabled",'" data-article=').concat(e.article,">\n\t\t\t\t\t<span>").concat(e.article).concat(e.documents.length?"":"<b>Нет файлов</b>","</span>\n\t\t\t\t\t<p>").concat(wrapSubstringInBold("".concat(e.title),t),"</p>\n\t\t\t\t</li>\n\t\t\t")}),this.elements.articleSearchResults.innerHTML=n,this.elements.articleSearchResults):this.elements.articleSearchFail).classList.add("visible")}},{key:"resetSearching",value:function(){var e=this.elements.articleSearch.querySelector("input");e&&(e.value="",this.elements.articleSearchProcessing.classList.remove("visible"),this.elements.articleSearchFail.classList.remove("visible"),this.elements.articleSearchResults.classList.remove("visible"),this.responseArticleData=[])}},{key:"setFilteringCollectionOptions",value:function(){var e,t=this,n=null==(e=this.elements.collectionSelector)?void 0:e.querySelector("input");n&&(n.addEventListener("input",function(){t.filteringCollectionOptions(n.value)}),null!=(e=this.elements.collectionSelector.querySelector(".single-selector__trigger")))&&e.addEventListener("click",function(){t.elements.collectionSelector.classList.contains("active")||t.resetFilteringCollection()})}},{key:"filteringCollectionOptions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=Array.from(this.elements.collectionSelector.querySelectorAll(".single-selector__option")),n=e.toLowerCase().trim();""===n?t.forEach(function(e){e.classList.remove("filtered")}):t.forEach(function(e){"".concat(e.dataset.value).toLowerCase().includes(n)?e.classList.remove("filtered"):e.classList.add("filtered")})}},{key:"resetFilteringCollection",value:function(){this.elements.collectionSelector.querySelector("input").value="",this.filteringCollectionOptions()}}],[{key:"getInstance",value:function(){return _instance._||(_instance._=new e),_instance._}}]);var t,n,r}(),_instance={_:null};window.addEventListener("load",_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=FileDownloader.getInstance(),e.next=3,t.init();case 3:case"end":return e.stop()}},e)})));